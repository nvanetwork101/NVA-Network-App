<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVA Network</title>
    <!-- Google Fonts - Bebas Neue for title, Inter for body -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PWA Enhancements START -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <meta name="theme-color" content="#0A0A0A">
    <!-- PWA Enhancements END -->
    <style>
        html, body {
            height: 100%; /* Ensure html and body take full height */
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per instructions */
            background-color: #0A0A0A;
            color: #FFF;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top to allow scrolling from the top */
            min-height: 100vh; /* Ensure body is at least viewport height */
            overflow-y: auto; /* Allow vertical scrolling for the entire body */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        #root {
            width: 100%;
            max-width: 450px; /* Typical mobile width constraint */
            /* Removed height: 100vh; to allow it to expand with content */
            background-color: #0A0A0A;
            display: flex;
            flex-direction: column;
            border-radius: 15px; /* Rounded corners for the main app container */
            /* Removed overflow: hidden; to allow content to push height */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            min-height: 100vh; /* Ensure #root is at least viewport height */
        }
        .container {
            flex: 1;
            background-color: #0A0A0A; /* Dark background */
            display: flex;
            flex-direction: column;
        }
        .header {
            position: relative; /* For absolute positioning of children and pseudo-element */
            height: 150px; /* Header height */
            padding: 0; /* No padding */
            background-color: #1A1A1A;
            border-bottom: 1px solid #333;
            border-radius: 15px 15px 0 0; /* Rounded top corners */
            overflow: hidden; /* Ensure content stays within bounds */
            z-index: 0; /* Establish a stacking context for its children */
        }
        /* Abstract grey art background for header, behind text */
        /* Removed .header::before rule */
        .headerTitle {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #FFD700; /* Gold color for branding */
            z-index: 3; /* Ensure it's above the abstract art */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7); /* Add subtle shadow for readability */
            font-family: 'Bebas Neue', sans-serif; /* Applied new font */
            font-size: 38px; /* Slightly larger for impact */
        }
        .tagline {
            position: absolute;
            bottom: 15px; /* Position at the bottom left */
            left: 15px; /* Position at the bottom left */
            font-size: 14px;
            color: #AAA; /* Original color */
            font-weight: normal; /* Original font weight */
            text-align: left; /* Align text to the left */
            z-index: 3; /* Ensure it's above the abstract art */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7); /* Add subtle shadow for readability */
        }
        .navigationBar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background-color: #1A1A1A;
            border-top: 1px solid #333;
            border-radius: 0 0 15px 15px; /* Rounded bottom corners */
            /* Removed flex-wrap and gap as Support Us is moved */
        }
        .navButton {
            padding: 8px 15px;
            border-radius: 25px; /* Adjusted for consistency with other buttons */
            cursor: pointer;
            transition: background-color 0.3s ease;
            background-color: #FFD700; /* Changed to gold for visibility */
            box-shadow: 0 4px 5px rgba(0, 0, 0, 0.3);
            border: none; /* Removed border */
        }
        .navButton:hover {
            background-color: #FFC400;
        }
        .navButtonText {
            color: #0A0A0A; /* Changed to black for visibility */
            font-size: 14px;
            font-weight: 600;
        }
        .activeNavButtonText {
            color: #0A0A0A; /* Changed to black for visibility on gold background */
        }
        .screenContainer {
            flex: 1;
            padding: 15px;
            /* Removed overflow-y: auto; here as body will handle overall scrolling */
            position: relative; /* Added for positioning the new support button */
        }
        .sectionTitle {
            font-size: 20px;
            font-weight: bold;
            color: #FFF;
            margin-bottom: 15px;
            margin-top: 20px;
        }
        .contentGrid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .contentCard {
            width: calc(50% - 7.5px); /* Roughly half width for two columns with spacing */
            margin-bottom: 15px;
            background-color: #2A2A2A;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.8);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .contentCard:hover {
            transform: translateY(-3px);
        }
        .thumbnailPlaceholder {
            width: 100%;
            height: 100px;
            background-color: #444;
            display: flex;
            flex-direction: column; /* To stack text and icon */
            justify-content: center;
            align-items: center;
            position: relative; /* For play icon positioning */
        }
        .thumbnailText {
            color: #FFF;
            font-size: 12px;
            margin-bottom: 5px; /* Space between text and icon */
        }
        .playIcon {
            width: 30px;
            height: 30px;
            fill: #FFD700; /* Gold color for play icon */
            opacity: 0.8;
        }
        .contentTitle {
            font-size: 14px;
            font-weight: bold;
            color: #FFF;
            padding: 10px;
        }
        .categoryTabs {
            margin-bottom: 15px;
            height: 40px;
            display: flex;
            overflow-x: auto; /* Enable horizontal scrolling for tabs */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            padding-bottom: 5px; /* Space for scrollbar */
        }
        .categoryTab {
            padding: 8px 15px;
            border-radius: 20px;
            background-color: #3A3A3A;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; /* Prevent tabs from shrinking */
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .categoryTab:hover {
            background-color: #4A4A4A;
        }
        .activeCategoryTab {
            background-color: #FFD700; /* Gold highlight for active category */
        }
        .categoryTabText {
            color: #FFF;
            font-weight: 600;
            white-space: nowrap; /* Prevent text wrapping */
        }
        .activeCategoryTabText {
            color: #0A0A0A; /* Dark text on gold background */
        }
        .categoryContent {
            flex: 1;
            /* Removed overflow-y: auto; here as body will handle overall scrolling */
        }
        /* Horizontal Carousel Styles (Featured Highlights) */
        .horizontal-carousel-container {
            width: 100%;
            overflow-x: hidden; /* Hide scrollbar, manage scrolling with JS */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            scroll-snap-type: x mandatory; /* Snap to items */
            scroll-behavior: smooth; /* Smooth scrolling animation */
            display: flex; /* Arrange items in a row */
            padding-bottom: 10px; /* Space for scrollbar */
            margin-bottom: 20px; /* Space below carousel */
        }

        .horizontal-carousel-item {
            flex: 0 0 calc(33.33% - 10px); /* Show 3 items, account for margin */
            margin-right: 15px; /* Spacing between items */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.8);
            scroll-snap-align: start; /* Snap to the start of each item */
            background-color: #2A2A2A; /* Placeholder background */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FFF;
            font-size: 12px;
            height: 100px; /* Fixed height for carousel images */
        }
        .horizontal-carousel-item:last-child {
            margin-right: 0; /* No margin on the last item */
        }
        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the item area */
            border-radius: 10px; /* Inherit border-radius */
        }

        /* Vertical Carousel Styles (Live Feed) */
        .vertical-carousel-container {
            width: 100%;
            height: 250px; /* Fixed height for vertical carousel to show ~2 items */
            overflow-y: hidden; /* Hide scrollbar, manage scrolling with JS */
            -webkit-overflow-scrolling: touch; /* Enable touch scrolling */
            scroll-snap-type: y mandatory; /* Snap to items */
            scroll-behavior: smooth; /* Smooth scrolling animation */
            display: flex;
            flex-direction: column; /* Arrange items in a column */
            margin-bottom: 20px;
            background-color: #1A1A1A;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.8);
        }

        .vertical-carousel-item {
            flex: 0 0 calc(50% - 10px); /* Show 2 items per view, with a gap */
            margin-bottom: 15px; /* Space between items */
            background-color: #2A2A2A;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            scroll-snap-align: start; /* Snap to the start of each item */
            display: flex;
            align-items: center;
            padding: 10px;
        }

        .vertical-carousel-item:last-child {
            margin-bottom: 0;
        }

        .liveFeedThumbnail {
            width: 80px; /* Fixed width for live feed thumbnails */
            height: 60px; /* Fixed height for live feed thumbnails (16:9 aspect ratio) */
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
        }

        .liveFeedContent {
            flex-grow: 1;
        }

        .liveFeedTitle {
            font-size: 14px;
            font-weight: bold;
            color: #FFF;
            margin-bottom: 5px;
        }

        .liveFeedCreator {
            font-size: 12px;
            color: #AAA;
        }

        .heading {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
        }
        .subHeading {
            font-size: 16px;
            color: #FFF;
            margin-bottom: 20px;
            text-align: center;
        }
        .paragraph {
            font-size: 14px;
            color: #CCC;
            margin-bottom: 10px;
            line-height: 20px;
        }
        .button {
            background-color: #FFD700;
            padding: 12px 25px;
            border-radius: 25px;
            align-self: center;
            margin-top: 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 5px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #FFC400;
        }
        .buttonText {
            color: #0A0A0A;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
        .smallText {
            font-size: 12px;
            color: #888;
            text-align: center;
            margin-bottom: 10px;
        }
        .listItem {
            font-size: 14px;
            color: #CCC;
            margin-left: 15px;
            margin-bottom: 5px;
        }
        .premiumFeatureCard {
            background-color: #2A2A2A;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
        }
        .premiumFeatureTitle {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }
        .premiumFeatureDescription {
            font-size: 14px;
            color: #CCC;
            line-height: 20px;
        }
        .pricingTable {
            background-color: #2A2A2A;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .pricingRow {
            display: flex;
            justify-content: space-between;
            padding-top: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }
        .pricingRow:last-child {
            border-bottom: none; /* No border for the last row */
        }
        .pricingTier {
            font-size: 16px;
            font-weight: bold;
            color: #FFD700;
            flex: 1;
        }
        .pricingFeatures {
            font-size: 14px;
            color: #CCC;
            flex: 2;
            text-align: left;
            margin-left: 10px;
        }
        .pricingPrice {
            font-size: 16px;
            font-weight: bold;
            color: #FFF;
            flex: 1;
            text-align: right;
        }
        .contactInfo {
            font-size: 14px;
            color: #CCC;
            margin-bottom: 5px;
        }
        .messageBox {
            position: fixed; /* Use fixed for overlay */
            bottom: 100px; /* Above navigation bar */
            left: 50%;
            transform: translateX(-50%); /* Center horizontally */
            background-color: rgba(0, 0, 0, 0.8);
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allow clicks to pass through */
            max-width: 90%;
        }
        .messageBox.hidden {
            opacity: 0;
        }
        .messageText {
            color: #FFF;
            text-align: center;
            font-size: 14px;
        }
        /* Video Modal Styles */
        .videoModalOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .videoModalContent {
            background-color: #1A1A1A;
            border-radius: 0; /* Removed for full screen effect */
            width: 100vw; /* Make it take 100% of viewport width */
            height: 100vh; /* Make it take 100% of viewport height */
            max-width: 1200px; /* Cap maximum width for very large screens */
            max-height: 800px; /* Cap maximum height for very large screens to maintain aspect ratio */
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            position: relative;
            display: flex; /* Enable flex for vertical centering of iframe */
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
        }
        .videoIframeContainer {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio (height relative to width) */
            height: 0; /* Important for padding-bottom trick */
            overflow: hidden;
        }
        .videoIframeContainer iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .closeButton {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            color: #FFF;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10; /* Ensure it's above the iframe */
        }

        /* Styles for buttons at the top of the Home screen */
        .topRightButtonContainer {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px; /* Space between buttons */
            z-index: 10;
        }

        .topButton {
            background-color: #FFD700; /* Gold color */
            color: #0A0A0A; /* Dark text */
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px; /* Smaller font for a compact button */
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
            transition: background-color 0.3s ease;
        }
        .topButton:hover {
            background-color: #FFC400;
        }


        /* Styles for Creator Campaign Cards */
        .campaignCard {
            background-color: #2A2A2A;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        .campaignTitle {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }
        .campaignCreator {
            font-size: 14px;
            color: #CCC;
            margin-bottom: 10px;
        }
        .campaignDescription {
            font-size: 14px;
            color: #AAA;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        .campaignProgressContainer {
            width: 100%;
            background-color: #444;
            border-radius: 5px;
            height: 10px;
            margin-bottom: 5px;
            overflow: hidden; /* Ensure progress bar stays within bounds */
        }
        .campaignProgressBar {
            height: 100%;
            background-color: #FFD700;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        .campaignStats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #CCC;
            margin-bottom: 15px;
        }
        .campaignGoal, .campaignRaised {
            font-weight: bold;
            color: #FFF;
        }
        .campaignButton {
            background-color: #FFD700;
            padding: 10px 15px;
            border-radius: 20px;
            color: #0A0A0A;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }
        .campaignButton:hover {
            background-color: #FFC400;
        }

        /* Styles for Creator Sign Up Form */
        .formGroup {
            margin-bottom: 15px;
        }
        .formLabel {
            display: block;
            font-size: 14px;
            color: #FFF;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .formInput, .formTextarea {
            width: calc(100% - 20px); /* Account for padding */
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #555;
            background-color: #333;
            color: #FFF;
            font-size: 14px;
        }
        .formTextarea {
            resize: vertical; /* Allow vertical resizing */
            min-height: 80px;
        }
        .checkboxGroup {
            margin-bottom: 15px;
        }
        .checkboxLabel {
            display: block;
            font-size: 14px;
            color: #FFF;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .checkboxItem {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .checkboxItem input[type="checkbox"] {
            margin-right: 8px;
            width: 18px; /* Larger checkbox for touch */
            height: 18px;
            accent-color: #FFD700; /* Highlight checkbox */
        }
        .termsText {
            font-size: 12px;
            color: #AAA;
            margin-top: 10px;
            line-height: 1.4;
        }
        .termsLink {
            color: #FFD700;
            text-decoration: none;
            font-weight: bold;
        }
        .termsLink:hover {
            text-decoration: underline;
        }

        /* Styles for Creator Dashboard */
        .dashboardSection {
            background-color: #2A2A2A;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
        }
        .dashboardSectionTitle {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }
        .dashboardItem {
            font-size: 14px;
            color: #CCC;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .dashboardButton {
            background-color: #FFD700;
            padding: 8px 15px;
            border-radius: 20px;
            color: #0A0A0A;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
            margin-top: 10px;
            margin-right: 10px;
        }
        .dashboardButton:hover {
            background-color: #FFC400;
        }
        .dashboardContentList {
            margin-top: 10px;
            padding-left: 0; /* Remove default ul padding */
            list-style: none; /* Remove bullet points */
        }
        .dashboardContentListItem {
            background-color: #3A3A3A;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #FFF;
        }
        .dashboardContentListItem span {
            flex-grow: 1;
        }
        .dashboardContentListItem .actionButton {
            background-color: #555;
            color: #FFF;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: background-color 0.2s ease;
        }
        .dashboardContentListItem .actionButton:hover {
            background-color: #777;
        }

        /* New styles for video link sections in dashboard */
        .videoLinkSection {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        .videoLinkSection:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .videoLinkSection .formLabel {
            margin-bottom: 10px;
            font-size: 16px;
            color: #FFD700;
        }
        .videoInputContainer {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .videoInputContainer .formInput {
            flex-grow: 1;
        }
        .videoThumbnailContainer {
            position: relative;
            width: 100%;
            height: 150px; /* Fixed height for thumbnails */
            background-color: #444;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer; /* Indicate clickable */
        }
        .videoThumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .videoThumbnailOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .thumbnailPlayIcon {
            width: 40px;
            height: 40px;
            fill: #FFF;
            opacity: 0.9;
        }
        .videoActions {
            display: flex;
            justify-content: flex-end; /* Align buttons to the right */
            gap: 10px;
        }
        .videoActions .actionButton {
            background-color: #FFD700;
            color: #0A0A0A;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }
        .videoActions .actionButton.remove {
            background-color: #DC3545; /* Red for remove */
            color: #FFF;
        }
        .videoActions .actionButton:hover {
            background-color: #FFC400;
        }
        .videoActions .actionButton.remove:hover {
            background-color: #C82333;
        }
        /* New styles for login form */
        .loginForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .loginForm .button {
            width: 100%;
        }
        /* New styling for section title with aligned button */
        .sectionHeaderWithButton {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px; /* Space below the header container */
            margin-top: 20px;
        }
        .sectionHeaderWithButton .sectionTitle {
            margin: 0; /* Remove default margins from p tag when in flex container */
        }
        /* Adjust .topButton styles for this context if needed, or create a new class */
        .sectionHeaderButton {
            background-color: #FFD700; /* Gold color */
            color: #0A0A0A; /* Dark text */
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px; /* Smaller font for a compact button */
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
            transition: background-color 0.3s ease;
        }
        .sectionHeaderButton:hover {
            background-color: #FFC400;
        }

        /* Profile Picture Adjustment Modal Styles */
        .imageAdjustModalOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95); /* More opaque */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Higher z-index than video modal */
            flex-direction: column;
            gap: 20px;
        }

        .imageAdjustModalContent {
            background-color: #1A1A1A;
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .canvasContainer {
            position: relative;
            width: 200px; /* Fixed size for the canvas view */
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #FFD700;
            background-color: #333;
            margin-bottom: 20px;
            cursor: grab;
        }

        .canvasContainer.dragging {
            cursor: grabbing;
        }

        canvas {
            display: block;
            touch-action: none;
        }

        .modalButtons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .modalButton {
            background-color: #FFD700;
            color: #0A0A0A;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }

        .modalButton:hover {
            background-color: #FFC400;
        }

        .modalButton.cancel {
            background-color: #555;
            color: #FFF;
        }

        .modalButton.cancel:hover {
            background-color: #777;
        }

        /* Styles for Zoom Controls */
        .zoomControls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }
        .zoomButton {
            background-color: #3A3A3A;
            color: #FFD700;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #FFD700;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .zoomButton:hover {
            background-color: #4A4A4A;
        }

        /* New styles for all campaigns list */
        .allCampaignsList {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        .allCampaignsListItem {
            background-color: #2A2A2A;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-start; /* Align items to the top */
            cursor: pointer; /* Pointer to indicate clickable for the whole card */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .allCampaignsListItem:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
        }
        .campaignListImagePlaceholder { /* New class for the image/button container */
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
            background-color: #3A3A3A; /* Background for the placeholder/button */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* For the button text */
            overflow: hidden; /* To handle background image overflow if it's large */
            background-size: cover; /* Make background image cover the area */
            background-position: center; /* Center the background image */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5); /* Subtle inner shadow */
        }
        .campaignListProjectButton { /* New class for the actual clickable button inside */
            background-color: rgba(255, 215, 0, 0.8); /* Semi-transparent gold */
            color: #0A0A0A;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s ease;
            position: absolute; /* Position over the background image */
            bottom: 5px; /* Place it at the bottom */
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap; /* Prevent text wrapping */
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
            line-height: 1; /* Adjust line height for smaller button */
        }
        .campaignListProjectButton:hover {
            background-color: #FFC400; /* Solid gold on hover */
        }

        .campaignListContent {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .campaignListTitle {
            font-size: 16px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }
        .campaignListCreator {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #CCC;
            margin-bottom: 8px;
        }
        .campaignListCreatorProfilePic {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 8px;
            border: 1px solid #FFD700; /* Small border for visibility */
        }
        .campaignListDescription {
            font-size: 13px;
            color: #AAA;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* Show only 2 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 10px;
        }
        .campaignListStats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #CCC;
            width: 100%;
        }
        .campaignListGoal, .campaignListRaised {
            font-weight: bold;
            color: #FFF;
        }

        /* Campaign Details Screen Specific Styles */
        .campaignDetailHeader {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .campaignDetailImage {
            width: 100%;
            max-width: 350px; /* Max width for images */
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        /* Style to hide image if it fails to load */
        .campaignDetailImage.hidden {
            display: none;
        }

        .campaignDetailTitle {
            font-size: 22px;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            margin-bottom: 10px;
        }
        .campaignDetailCreator {
            display: flex;
            align-items: center;
            font-size: 15px;
            color: #CCC;
            margin-bottom: 15px;
        }
        .campaignDetailCreatorProfilePic {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 2px solid #FFD700;
        }
        .campaignDetailDescription {
            font-size: 14px;
            color: #AAA;
            line-height: 1.6;
            margin-bottom: 20px;
            background-color: #1A1A1A;
            padding: 15px;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .campaignDetailStats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px 0;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }
        .campaignDetailStatItem {
            text-align: center;
            font-size: 14px;
            color: #CCC;
        }
        .campaignDetailStatValue {
            font-size: 18px;
            font-weight: bold;
            color: #FFF;
        }
        .campaignDetailProgressBarContainer {
            width: 80%;
            background-color: #444;
            border-radius: 5px;
            height: 12px;
            margin-bottom: 10px;
            overflow: hidden;
            align-self: center; /* Center the progress bar */
        }
        .campaignDetailProgressBar {
            height: 100%;
            background-color: #FFD700;
            border-radius: 5px;
        }

        /* Admin Dashboard Specific Styles */
        .adminActionButton {
            background-color: #FFD700;
            color: #0A0A0A;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            margin-left: 10px;
            transition: background-color 0.2s ease;
        }
        .adminActionButton.approve {
            background-color: #008000; /* Green for approve */
            color: #FFF;
        }
        .adminActionButton.reject {
            background-color: #DC3545; /* Red for reject */
            color: #FFF;
        }
        .adminActionButton:hover {
            filter: brightness(1.1);
        }
        .adminActionButton.approve:hover {
            background-color: #006400;
        }
        .adminActionButton.reject:hover {
            background-color: #C82333;
        }
        .adminDashboardItem {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #3A3A3A;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #FFF;
            font-size: 14px;
        }
        .adminDashboardItemTitle {
            flex-grow: 1;
            font-weight: bold;
        }
        .adminDashboardItemStatus {
            font-size: 12px;
            margin-left: 10px;
            color: #FFD700; /* Default for pending */
        }
        .adminDashboardItemStatus.active {
            color: #00FF00;
        }
        .adminDashboardItemStatus.rejected {
            color: #DC3545;
        }

        /* Confirmation Modal Styles */
        .confirmationModalOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Higher than any other modal */
        }

        .confirmationModalContent {
            background-color: #1A1A1A;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            text-align: center;
            color: #FFF;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .confirmationModalTitle {
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .confirmationModalMessage {
            font-size: 15px;
            color: #CCC;
            line-height: 1.5;
        }

        .confirmationModalButtons {
            display: flex;
            justify-content: space-around;
            gap: 15px;
            margin-top: 15px;
        }

        .confirmationButton {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
            flex-grow: 1;
        }

        .confirmationButton.confirm {
            background-color: #008000; /* Green for confirm */
            color: #FFF;
        }

        .confirmationButton.confirm:hover {
            background-color: #006400;
        }

        .confirmationButton.cancel {
            background-color: #DC3545; /* Red for cancel */
            color: #FFF;
        }

        .confirmationButton.cancel:hover {
            background-color: #C82333;
        }

        /* Updated style for the arrow buttons in Admin Dashboard */
        .admin-toggle-button {
            background-color: #FFD700; /* Gold background */
            color: #0A0A0A; /* Black arrow color */
            padding: 5px 10px; /* Padding for button feel */
            border-radius: 9999px; /* Fully rounded */
            font-size: 20px; /* Adjusted font size for new symbols */
            font-weight: bold;
            display: flex; /* To center the arrow */
            justify-content: center;
            align-items: center;
            width: 40px; /* Fixed width for consistent circle */
            height: 40px; /* Fixed height for consistent circle */
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* More prominent shadow for gold button */
        }
        .admin-toggle-button:hover {
            background-color: #FFC400; /* Slightly darker gold on hover */
            transform: scale(1.05); /* Slight scale effect on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5); /* Enhanced shadow on hover */
        }


    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 1. Initialize Firebase SDKs (module type) - Must be loaded before React components that use them -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, orderBy, onSnapshot, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

        // Global Firebase variables (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDUGp5pjqrushhUDPa9RLLp2xmttnKqU9Q",
            authDomain: "nvanetworkapp.firebaseapp.com",
            projectId: "nvanetworkapp",
            storageBucket: "nvanetworkapp.firebasestorage.app",
            messagingSenderId: "122220543439",
            appId: "1:122220543439:web:e36ccce435463b7939a6ba",
            measurementId: "G-6RNS6DH3G0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app); // Initialize Storage
        const analytics = getAnalytics(app);

        // Export for use in React component
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseStorage = storage; // Export Storage
        window.initialAuthToken = initialAuthToken; // Export corrected initialAuthToken
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword; // Expose the function itself
        window.signInWithEmailAndPassword = signInWithEmailAndPassword; // Expose sign-in function
        window.signOut = signOut; // Expose sign-out function
        window.onAuthStateChanged = onAuthStateChanged; // Expose auth state listener
        window.doc = doc; // Expose Firestore doc
        window.setDoc = setDoc; // Expose Firestore setDoc
        window.getDoc = getDoc; // Expose Firestore getDoc
        window.updateDoc = updateDoc; // Expose Firestore updateDoc
        window.collection = collection; // Expose Firestore collection
        window.addDoc = addDoc; // Expose Firestore addDoc
        window.query = query; // Expose Firestore query
        window.orderBy = orderBy; // Expose Firestore orderBy
        window.onSnapshot = onSnapshot; // Expose Firestore onSnapshot
        window.where = where; // Expose where for Firestore queries
        window.getDocs = getDocs; // Expose getDocs for Firestore queries
        window.ref = ref;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
        window.appId = appId;
        window.signInWithCustomToken = signInWithCustomToken; // Expose signInWithCustomToken
        window.signInAnonymously = signInAnonymously; // Expose signInAnonymously
    </script>

    <!-- 2. Load React and ReactDOM (synchronously, no defer) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Load Babel (synchronously, to process JSX from the next script) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Define your React App component (JSX content here) -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const auth = window.firebaseAuth;
        const db = window.firebaseDb;
        const storage = window.firebaseStorage;
        const createUserWithEmailAndPassword = window.createUserWithEmailAndPassword;
        const signInWithEmailAndPassword = window.signInWithEmailAndPassword;
        const signOut = window.signOut;
        const onAuthStateChanged = window.onAuthStateChanged;
        const doc = window.doc;
        const setDoc = window.setDoc;
        const getDoc = window.getDoc;
        const updateDoc = window.updateDoc;
        const collection = window.collection;
        const addDoc = window.addDoc;
        const query = window.query;
        const orderBy = window.orderBy;
        const onSnapshot = window.onSnapshot;
        const where = window.where; // Added where for Firestore queries
        const getDocs = window.getDocs; // Added getDocs for Firestore queries
        const ref = window.ref;
        const uploadBytes = window.uploadBytes;
        const getDownloadURL = window.getDownloadURL;
        const appId = window.appId;


        const featuredContent = [
            { id: '1', title: 'Guyanese Comedy Special', type: 'skit', url: 'https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1', creator: 'Comedy Crew' },
            { id: '2', title: 'Top Guyanese Skits: Best of 2024', type: 'skit', url: 'https://www.youtube.com/embed/oHg5SJYRHA0?autoplay=1', creator: 'Laugh Central' },
            { id: '3', title: 'Indie Film: "Georgetown Dreams"', type: 'short-film', url: 'https://www.youtube.com/embed/34Na4j8AVgA?autoplay=1', creator: 'Indie Films GY' },
            { id: '4', title: 'Live Concert Replay: Mashramani', type: 'live-premiere', url: 'https://www.youtube.com/embed/example4?autoplay=1', creator: 'Vibes Ent.' },
            { id: '5', title: 'Creator Interview: Rise of Talent', type: 'interview', url: 'https://www.youtube.com/embed/example5?autoplay=1', creator: 'NVA Insights' },
            { id: '6', title: 'Short Film: "The Golden Arrowhead"', type: 'short-film', url: 'https://www.youtube.com/embed/example6?autoplay=1', creator: 'Heritage Films' },
            { id: '7', title: 'New Skit Series: "Life in GT"', type: 'skit', url: 'https://www.youtube.com/embed/skit7?autoplay=1', creator: 'GT Daily' },
            { id: '8', title: 'Cooking Show: Guyanese Delights', type: 'skit', url: 'https://www.youtube.com/embed/skit8?autoplay=1', creator: 'Chef Roti' },
            { id: '9', title: 'Poetry Slam Live: Best of Season', type: 'live-premiere', url: 'https://www.youtube.com/embed/live9?autoplay=1', creator: 'Wordsmiths GY' },
            { id: '10', title: 'Wildlife Doc: Amazonian Secrets', type: 'documentary', url: 'https://www.youtube.com/embed/doc1?autoplay=1', creator: 'Nature Watch' },
            { id: '11', title: 'Guyanese Music Spotlight', type: 'music', url: 'https://www.youtube.com/embed/music1?autoplay=1', creator: 'Riddim Connect' },
            { id: '12', title: 'Interview: Young Entrepreneurs', type: 'interview', url: 'https://www.youtube.com/embed/int1?autoplay=1', creator: 'Business Buzz GY' },
        ];


        const categories = {
            Skits: [
                { id: 's1', title: 'Laugh Out Loud: Best Skits Vol. 1', url: 'https://www.youtube.com/embed/skit1?autoplay=1' },
                { id: 's2', title: 'Daily Dose of Guyanese Humor', url: 'https://www.youtube.com/embed/skit2?autoplay=1' },
                { id: 's3', title: 'Guyana Vibes: Street Comedy', url: 'https://www.youtube.com/embed/skit3?autoplay=1' },
                { id: 's4', title: 'Caribbean Laughs: Episode 1', url: 'https://www.youtube.com/embed/skit4?autoplay=1' },
                { id: 's5', title: 'Funny Moments: Local Edition', url: 'https://www.youtube.com/embed/skit5?autoplay=1' },
                { id: 's6', title: 'The Best of Guyanese Skits', url: 'https://www.youtube.com/embed/skit6?autoplay=1' },
                { id: 's7', title: 'New Skit Series: "Life in GT"', url: 'https://www.youtube.com/embed/skit7?autoplay=1' },
                { id: 's8', title: 'Weekend Comedy Mashup', url: 'https://www.youtube.com/embed/skit8?autoplay=1' },
            ],
            'Short Films': [
                { id: 'sf1', title: 'The Golden Arrowhead: A Short Film', url: 'https://www.youtube.com/embed/shortfilm1?autoplay=1' },
                { id: 'sf2', title: 'Tales from the Coast: Episode 1', url: 'https://www.youtube.com/embed/shortfilm2?autoplay=1' },
                { id: 'sf3', title: 'Lost in the Jungle: A Drama', url: 'https://www.youtube.com/embed/shortfilm3?autoplay=1' },
                { id: 'sf4', title: 'The Cane Field Mystery', url: 'https://www.youtube.com/embed/shortfilm4?autoplay=1' },
                { id: 'sf5', title: 'A Day in the Market', url: 'https://www.youtube.com/embed/shortfilm5?autoplay=1' },
                { id: 'sf6', title: 'The Hidden Falls', url: 'https://www.youtube.com/embed/shortfilm6?autoplay=1' },
                { id: 'sf7', title: 'City Lights, Country Dreams', url: 'https://www.youtube.com/embed/shortfilm7?autoplay=1' },
                { id: 'sf8', title: 'Echoes of the Past', url: 'https://www.youtube.com/embed/shortfilm8?autoplay=1' },
            ],
            Interviews: [
                { id: 'i1', title: 'Creator Spotlight: Interview with Mark X', url: 'https://www.youtube.com/embed/interview1?autoplay=1' },
                { id: 'i2', title: 'Behind the Scenes: NVA Network', url: 'https://www.youtube.com/embed/interview2?autoplay=1' },
                { id: 'i3', title: 'Guyanese Icons: A Conversation', url: 'https://www.youtube.com/embed/interview3?autoplay=1' },
                { id: 'i4', title: 'The Future of Guyanese Art', url: 'https://www.youtube.com/embed/interview4?autoplay=1' },
                { id: 'i5', title: 'In-Depth with Local Artists', url: 'https://www.youtube.com/embed/interview5?autoplay=1' },
                { id: 'i6', title: 'Entrepreneurial Journeys in Guyana', url: 'https://www.youtube.com/embed/interview6?autoplay=1' },
                { id: 'i7', title: 'Community Leaders Speak Out', url: 'https://www.youtube.com/embed/interview7?autoplay=1' },
                { id: 'i8', title: 'The Making of a Guyanese Star', url: 'https://www.youtube.com/embed/interview8?autoplay=1' },
            ],
            'Live Premieres': [
                { id: 'lp1', title: 'Upcoming: Guyanese Music Festival Live', url: 'https://www.youtube.com/embed/live1?autoplay=1' },
                { id: 'lp2', title: 'Replay: NVA Network Launch Event', url: 'https://www.youtube.com/embed/live2?autoplay=1' },
                { id: 'lp3', title: 'Live Comedy Night: Best of Guyana', url: 'https://www.youtube.com/embed/live3?autoplay=1' },
                { id: 'lp4', title: 'Red Carpet Gala: NVA Awards', url: 'https://www.youtube.com/embed/live4?autoplay=1' },
                { id: 'lp5', title: 'Exclusive: Talk Show Live', url: 'https://www.youtube.com/embed/live5?autoplay=1' },
                { id: 'lp6', title: 'Poetry Slam Live: Guyana Edition', url: 'https://www.youtube.com/embed/live6?autoplay=1' },
                { id: 'lp7', title: 'Cultural Dance Showcase', url: 'https://www.youtube.com/embed/live7?autoplay=1' },
                { id: 'lp8', title: 'Q&A with Your Favorite Creators', url: 'https://www.youtube.com/embed/live8?autoplay=1' },
            ],
        };

        const getYouTubeEmbedUrl = (youtubeUrl) => {
            const videoIdMatch = youtubeUrl.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/||shorts\/))([^&?#]+)/);
            if (videoIdMatch && videoIdMatch[1]) {
                return `https://www.youtube.com/embed/${videoIdMatch[1]}?autoplay=1&rel=0`;
            }
            return youtubeUrl;
        };

        const VideoPlayerModal = ({ videoUrl, onClose }) => {
            if (!videoUrl) return null;

            const embedUrl = getYouTubeEmbedUrl(videoUrl);

            return (
                <div className="videoModalOverlay">
                    <div className="videoModalContent">
                        <button className="closeButton" onClick={onClose}>&times;</button>
                        <div className="videoIframeContainer">
                            <iframe
                                src={embedUrl}
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowFullScreen
                                title="Embedded YouTube video"
                            ></iframe>
                        </div>
                    </div>
                </div>
            );
        };

        const ProfilePictureAdjustModal = ({ imageUrl, onSave, onCancel, showMessage }) => {
            const canvasRef = useRef(null);
            const imageRef = useRef(new Image());
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });

            const canvasSize = 200;
            const devicePixelRatio = window.devicePixelRatio || 1;
            const adjustedCanvasSize = canvasSize * devicePixelRatio;
            const profilePicSize = 300;

            const constrainPosition = (pos) => {
                const img = imageRef.current;
                if (!img || !img.complete) return pos;
                
                const scaledWidth = img.naturalWidth * scale;
                const scaledHeight = img.naturalHeight * scale;
                
                // Calculate boundaries for dragging
                // The image should always cover the circular canvas area.
                // The center of the image relative to its scaled size should not move outside the canvas boundaries.
                const minX = canvasSize / 2 - scaledWidth / 2;
                const maxX = scaledWidth / 2 - canvasSize / 2;
                const minY = canvasSize / 2 - scaledHeight / 2;
                const maxY = scaledHeight / 2 - canvasSize / 2;
                
                return {
                    x: Math.min(maxX, Math.max(minX, pos.x)),
                    y: Math.min(maxY, Math.max(minY, pos.y))
                };
            };

            const getRelativeCoordinates = (clientX, clientY) => {
                const canvas = canvasRef.current;
                if (!canvas) return { x: 0, y: 0 };
                
                const rect = canvas.getBoundingClientRect();
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            };

            const drawImage = useCallback(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const img = imageRef.current;

                if (!img.complete || img.naturalWidth === 0) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    return;
                }

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();

                ctx.beginPath();
                ctx.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.clip();

                const scaledWidth = img.naturalWidth * scale;
                const scaledHeight = img.naturalHeight * scale;

                const drawX = (canvasSize / 2) - (scaledWidth / 2) + position.x;
                const drawY = (canvasSize / 2) - (scaledHeight / 2) + position.y;

                ctx.drawImage(img, drawX, drawY, scaledWidth, scaledHeight);

                ctx.restore();
            }, [scale, position, canvasSize]);


            useEffect(() => {
                const canvas = canvasRef.current;
                if (canvas) {
                    canvas.width = adjustedCanvasSize;
                    canvas.height = adjustedCanvasSize;
                    canvas.style.width = `${canvasSize}px`;
                    canvas.style.height = `${canvasSize}px`;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.scale(devicePixelRatio, devicePixelRatio);
                }
            }, [adjustedCanvasSize, canvasSize, devicePixelRatio]);

            useEffect(() => {
                const img = imageRef.current;
                img.crossOrigin = 'anonymous';
                img.src = imageUrl;

                img.onload = () => {
                    // Calculate initial scale to cover the canvas circle
                    const aspectRatio = img.naturalWidth / img.naturalHeight;
                    let initialScale;
                    if (img.naturalWidth < img.naturalHeight) {
                        initialScale = canvasSize / img.naturalWidth;
                    } else {
                        initialScale = canvasSize / img.naturalHeight;
                    }
                    
                    // Ensure the image always fills the circle, even if it's very narrow/wide
                    const scaledWidth = img.naturalWidth * initialScale;
                    const scaledHeight = img.naturalHeight * initialScale;

                    if (scaledWidth < canvasSize || scaledHeight < canvasSize) {
                        initialScale = Math.max(canvasSize / img.naturalWidth, canvasSize / img.naturalHeight);
                    }

                    setScale(initialScale);
                    setPosition({ x: 0, y: 0 }); // Reset position
                    drawImage();
                };

                img.onerror = () => {
                    showMessage("Failed to load image for adjustment. Please check the image URL.");
                    console.error("Image failed to load for adjustment:", imageUrl);
                };
            }, [imageUrl, drawImage, showMessage, canvasSize]);


            useEffect(() => {
                drawImage();
            }, [scale, position, drawImage]);

            const handleMouseDown = (e) => {
                setIsDragging(true);
                const { x, y } = getRelativeCoordinates(e.clientX, e.clientY);
                setDragStart({ x, y });
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                
                const { x, y } = getRelativeCoordinates(e.clientX, e.clientY);
                const dx = x - dragStart.x;
                const dy = y - dragStart.y;
                
                setPosition(prev => {
                    const newPos = { x: prev.x + dx, y: prev.y + dy };
                    return constrainPosition(newPos);
                });
                
                setDragStart({ x, y });
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            const handleMouseLeave = () => {
                setIsDragging(false);
            };

            const lastTouch = useRef([]);

            const handleTouchStart = (e) => {
                if (e.touches.length === 1) {
                    setIsDragging(true);
                    const { x, y } = getRelativeCoordinates(e.touches[0].clientX, e.touches[0].clientY);
                    setDragStart({ x, y });
                } else if (e.touches.length === 2) {
                    setIsDragging(false);
                    lastTouch.current = [
                        { x: e.touches[0].clientX, y: e.touches[0].clientY },
                        { x: e.touches[1].clientX, y: e.touches[1].clientY }
                    ];
                }
            };

            const handleTouchMove = (e) => {
                e.preventDefault();

                const canvas = canvasRef.current;
                if (!canvas || !imageRef.current.complete) return;

                if (e.touches.length === 1 && isDragging) {
                    const { x, y } = getRelativeCoordinates(e.touches[0].clientX, e.touches[0].clientY);
                    const dx = x - dragStart.x;
                    const dy = y - dragStart.y;
                    
                    setPosition(prev => {
                        const newPos = { x: prev.x + dx, y: prev.y + dy };
                        return constrainPosition(newPos);
                    });
                    
                    setDragStart({ x, y });
                } else if (e.touches.length === 2 && lastTouch.current.length === 2) {
                    const touch1 = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                    const touch2 = { x: e.touches[1].clientX, y: e.touches[1].clientY };

                    const centerX = (touch1.x + touch2.x) / 2;
                    const centerY = (touch1.y + touch2.y) / 2;
                    const centerPoint = getRelativeCoordinates(centerX, centerY);
                    
                    const prevDistance = Math.hypot(
                        lastTouch.current[1].x - lastTouch.current[0].x,
                        lastTouch.current[1].y - lastTouch.current[0].y
                    );
                    const currentDistance = Math.hypot(touch2.x - touch1.x, touch2.y - touch1.y);
                    
                    const zoomFactor = currentDistance / prevDistance;
                    
                    setScale(prevScale => {
                        const newScale = Math.max(0.1, Math.min(prevScale * zoomFactor, 10));
                        
                        setPosition(prevPos => {
                            // Adjust position based on zoom center
                            const img = imageRef.current;
                            const currentImgX = (canvasSize / 2) - (img.naturalWidth * prevScale / 2) + prevPos.x;
                            const currentImgY = (canvasSize / 2) - (img.naturalHeight * prevScale / 2) + prevPos.y;

                            const newImgX = (canvasSize / 2) - (img.naturalWidth * newScale / 2) + prevPos.x;
                            const newImgY = (canvasSize / 2) - (img.naturalHeight * newScale / 2) + prevPos.y;

                            const deltaX = (centerPoint.x - currentImgX) * (newScale / prevScale - 1);
                            const deltaY = (centerPoint.y - currentImgY) * (newScale / prevScale - 1);

                            return constrainPosition({
                                x: prevPos.x - deltaX,
                                y: prevPos.y - deltaY
                            });
                        });
                        
                        return newScale;
                    });
                    
                    lastTouch.current = [touch1, touch2];
                }
            };

            const handleTouchEnd = () => {
                setIsDragging(false);
                lastTouch.current = [];
            };

            const handleWheel = (e) => {
                e.preventDefault();
                const zoomAmount = 0.1;
                const newScale = e.deltaY < 0 ? scale + zoomAmount : scale - zoomAmount;
                setScale(s => {
                    const finalScale = Math.max(0.1, Math.min(newScale, 10));
                    return finalScale;
                });
            };

            const saveCroppedImage = () => {
                const img = imageRef.current;
                if (!img.complete || img.naturalWidth === 0) {
                    showMessage("Image not loaded for saving. Please try again.");
                    return;
                }

                const outputCanvas = document.createElement('canvas');
                outputCanvas.width = profilePicSize;
                outputCanvas.height = profilePicSize;
                const ctx = outputCanvas.getContext('2d');

                ctx.beginPath();
                ctx.arc(profilePicSize / 2, profilePicSize / 2, profilePicSize / 2, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.clip();

                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, profilePicSize, profilePicSize);

                const scaledWidth = img.naturalWidth * scale;
                const scaledHeight = img.naturalHeight * scale;

                // Calculate the portion of the original image to draw
                // This is the inverse of the transformations applied to draw on the canvas
                const sourceX = (canvasSize / 2 - scaledWidth / 2 + position.x) / scale;
                const sourceY = (canvasSize / 2 - scaledHeight / 2 + position.y) / scale;
                const sourceWidth = canvasSize / scale;
                const sourceHeight = canvasSize / scale;

                ctx.drawImage(
                    img,
                    sourceX,
                    sourceY,
                    sourceWidth,
                    sourceHeight,
                    0, // Destination x
                    0, // Destination y
                    profilePicSize, // Destination width
                    profilePicSize // Destination height
                );

                outputCanvas.toBlob((blob) => {
                    if (blob) {
                        onSave(blob);
                    } else {
                        showMessage("Failed to create image file. Please try again.");
                    }
                }, 'image/png', 0.9);
            };

            return (
                <div className="imageAdjustModalOverlay">
                    <div className="imageAdjustModalContent">
                        <p className="heading" style={{fontSize: '20px', marginBottom: '10px'}}>Adjust Profile Picture</p>
                        <p className="subHeading" style={{fontSize: '14px', marginBottom: '15px', color: '#CCC'}}>Drag to pan, scroll/pinch to zoom.</p>
                        <div
                            className={`canvasContainer ${isDragging ? 'dragging' : ''}`}
                            onMouseDown={handleMouseDown}
                            onMouseMove={handleMouseMove}
                            onMouseUp={handleMouseUp}
                            onMouseLeave={handleMouseLeave}
                            onWheel={handleWheel}
                            onTouchStart={handleTouchStart}
                            onTouchMove={handleTouchMove}
                            onTouchEnd={handleTouchEnd}
                        >
                            <canvas
                                ref={canvasRef}
                                width={canvasSize}
                                height={canvasSize}
                            ></canvas>
                        </div>
                        <div className="zoomControls">
                            <button className="zoomButton" onClick={() => setScale(s => Math.max(0.1, s - 0.1))}>-</button>
                            <span style={{color: '#FFF', fontSize: '16px'}}>Zoom: {Math.round(scale * 100)}%</span>
                            <button className="zoomButton" onClick={() => setScale(s => Math.min(10, s + 0.1))}>+</button>
                        </div>
                        <button
                            className="modalButton"
                            onClick={() => {
                                const img = imageRef.current;
                                if (img && img.complete) {
                                    const aspectRatio = img.naturalWidth / img.naturalHeight;
                                    let initialScale;
                                    if (img.naturalWidth < img.naturalHeight) {
                                        initialScale = canvasSize / img.naturalWidth;
                                    } else {
                                        initialScale = canvasSize / img.naturalHeight;
                                    }
                                    const scaledWidth = img.naturalWidth * initialScale;
                                    const scaledHeight = img.naturalHeight * initialScale;

                                    if (scaledWidth < canvasSize || scaledHeight < canvasSize) {
                                        initialScale = Math.max(canvasSize / img.naturalWidth, canvasSize / img.naturalHeight);
                                    }

                                    setScale(initialScale);
                                    setPosition({ x: 0, y: 0 });
                                }
                            }}
                            style={{marginTop: '10px', backgroundColor: '#555', color: '#FFF'}}
                        >
                            Reset Image
                        </button>
                        <div className="modalButtons">
                            <button className="modalButton" onClick={saveCroppedImage}>Save</button>
                            <button className="modalButton cancel" onClick={onCancel}>Cancel</button>
                        </div>
                    </div>
                </div>
            );
        };

        const CreateCampaignScreen = ({ showMessage, setActiveScreen, currentUser, creatorProfile }) => {
            const [title, setTitle] = useState('');
            const [description, setDescription] = useState('');
            const [goal, setGoal] = useState('');
            const [imageUrl, setImageUrl] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();

                if (!title || !description || !goal) {
                    showMessage('Please fill in all required fields: Title, Description, and Funding Goal.');
                    return;
                }
                if (isNaN(goal) || parseFloat(goal) <= 0) {
                    showMessage('Funding Goal must be a positive number.');
                    return;
                }

                if (!currentUser || !creatorProfile) {
                    showMessage('Error: Creator data not available. Please log in.');
                    return;
                }

                try {
                    // Check if the creator already has an active campaign (endDate in the future and status 'active')
                    const campaignsCollectionRef = collection(db, `artifacts/${appId}/public/data/campaigns`);
                    const now = new Date().toISOString();
                    const q = query(
                        campaignsCollectionRef,
                        where('creatorId', '==', currentUser.uid),
                        where('status', '==', 'active'), // Only count active campaigns
                        where('endDate', '>', now)
                    );
                    const querySnapshot = await getDocs(q);

                    if (!querySnapshot.empty) {
                        showMessage('You can only have one active crowdfunding campaign at a time. Please wait for it to end or manage it in your dashboard.');
                        return;
                    }

                    const createdAt = new Date();
                    const endDate = new Date(createdAt);
                    endDate.setDate(createdAt.getDate() + 30); // 30 days from creation

                    await addDoc(campaignsCollectionRef, {
                        creatorId: currentUser.uid,
                        creatorName: creatorProfile.creatorName || currentUser.email,
                        creatorProfilePictureUrl: creatorProfile.profilePictureUrl || 'https://placehold.co/100x100/555/FFF?text=Profile',
                        title: title,
                        description: description,
                        goal: parseFloat(goal),
                        raised: 0,
                        imageUrl: imageUrl || '', // Now uses empty string instead of placeholder URL if no image is provided
                        createdAt: createdAt.toISOString(),
                        endDate: endDate.toISOString(), // Save the calculated end date
                        status: 'pending' // Initial status is pending approval
                    });

                    showMessage(`Campaign "${title}" submitted for review! It will appear on the public page once approved.`);
                    setActiveScreen('CreatorDashboard');
                } catch (error) {
                    console.error("Error creating campaign:", error);
                    showMessage(`Failed to create campaign: ${error.message}. Please check your internet and Firestore rules.`);
                }
            };

            return (
                <div className="screenContainer">
                    <p className="heading">Create New Campaign</p>
                    <p className="subHeading">Tell us about your project and your funding goal. Campaign will run for 30 days.</p>
                    <p className="smallText" style={{ textAlign: 'center', color: '#CCC', marginBottom: '15px' }}>
                        Your campaign will be reviewed by NVA Network administrators and will appear on the public "All Campaigns" page once approved.
                    </p>

                    <form onSubmit={handleSubmit}>
                        <div className="formGroup">
                            <label htmlFor="campaignTitle" className="formLabel">Campaign Title:</label>
                            <input
                                type="text"
                                id="campaignTitle"
                                className="formInput"
                                value={title}
                                onChange={(e) => setTitle(e.target.value)}
                                required
                            />
                        </div>

                        <div className="formGroup">
                            <label htmlFor="campaignDescription" className="formLabel">Description:</label>
                            <textarea
                                id="campaignDescription"
                                className="formTextarea"
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                placeholder="Describe your project, what you need funding for, and what supporters will get!"
                                required
                            ></textarea>
                        </div>

                        <div className="formGroup">
                            <label htmlFor="campaignGoal" className="formLabel">Funding Goal (USD):</label>
                            <input
                                type="number"
                                id="campaignGoal"
                                className="formInput"
                                value={goal}
                                onChange={(e) => setGoal(e.target.value)}
                                min="1"
                                step="any"
                                required
                            />
                        </div>

                        <div className="formGroup">
                            <label htmlFor="campaignImage" className="formLabel">Project Link / Image URL (Optional):</label>
                            <input
                                type="url"
                                id="campaignImage"
                                className="formInput"
                                value={imageUrl}
                                onChange={(e) => setImageUrl(e.target.value)}
                                placeholder="e.g., https://yourproject.com or https://example.com/image.jpg"
                            />
                        </div>

                        <button type="submit" className="button">
                            <span className="buttonText">Submit Campaign for Review</span>
                        </button>
                    </form>

                    <button
                        className="button"
                        onClick={() => setActiveScreen('CreatorDashboard')}
                        style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                    >
                        <span className="buttonText">Cancel and Back to Dashboard</span>
                    </button>
                </div>
            );
        };

        const AllCampaignsScreen = ({ showMessage, setActiveScreen, setSelectedCampaignId }) => {
            const [campaigns, setCampaigns] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const campaignsCollectionRef = collection(db, `artifacts/${appId}/public/data/campaigns`);
                const q = query(
                    campaignsCollectionRef,
                    where('status', '==', 'active'), // Only show active campaigns
                    orderBy('createdAt', 'desc')
                );

                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const fetchedCampaigns = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setCampaigns(fetchedCampaigns);
                    setLoading(false);
                }, (error) => {
                    console.error("Error fetching campaigns:", error);
                    showMessage("Failed to load campaigns. Please try again.");
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);


            if (loading) {
                return (
                    <div className="screenContainer" style={{ textAlign: 'center', paddingTop: '50px' }}>
                        <p className="heading">Loading Campaigns...</p>
                        <p className="subHeading" style={{ color: '#FFD700' }}>Please ensure you have an internet connection.</p>
                    </div>
                );
            }

            return (
                <div className="screenContainer">
                    <p className="heading">All Campaigns</p>
                    <p className="subHeading">Discover and support projects by Guyanese creators!</p>

                    {campaigns.length === 0 ? (
                        <p className="paragraph" style={{ textAlign: 'center', marginTop: '20px' }}>No active campaigns found yet.</p>
                    ) : (
                        <div className="allCampaignsList">
                            {campaigns.map(campaign => {
                                const isEnded = new Date(campaign.endDate) < new Date();
                                return (
                                    <div
                                        key={campaign.id}
                                        className="allCampaignsListItem"
                                        onClick={() => {
                                            setSelectedCampaignId(campaign.id);
                                            setActiveScreen('CampaignDetails');
                                        }}
                                    >
                                        <div
                                            className="campaignListImagePlaceholder"
                                            style={{ backgroundImage: campaign.imageUrl ? `url(${campaign.imageUrl})` : 'none' }}
                                            onError={(e) => { e.target.onerror = null; e.target.style.backgroundImage='none'; }} /* No background image on error */
                                        >
                                            <button
                                                className="campaignListProjectButton"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    if (campaign.imageUrl) {
                                                        window.open(campaign.imageUrl, '_blank');
                                                    } else {
                                                        showMessage('No project link provided for this campaign.');
                                                    }
                                                }}
                                            >
                                                View Project
                                            </button>
                                        </div>
                                        <div className="campaignListContent">
                                            <p className="campaignListTitle">
                                                {campaign.title} {isEnded && <span style={{color: '#DC3545', fontSize: '12px'}}>(Ended)</span>}
                                            </p>
                                            <div className="campaignListCreator">
                                                <img
                                                    src={campaign.creatorProfilePictureUrl || 'https://placehold.co/100x100/555/FFF?text=Profile'}
                                                    alt={campaign.creatorName}
                                                    className="campaignListCreatorProfilePic"
                                                    onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/24x24/555/FFF?text=P'; }}
                                                />
                                                <span>by {campaign.creatorName}</span>
                                            </div>
                                            <p className="campaignListDescription">{campaign.description}</p>
                                            <div className="campaignProgressContainer" style={{ height: '8px', marginBottom: '5px' }}>
                                                <div
                                                    className="campaignProgressBar"
                                                    style={{ width: `${(campaign.raised / campaign.goal) * 100}%` }}
                                                ></div>
                                            </div>
                                            <div className="campaignListStats">
                                                <span>Raised: <span className="campaignListRaised">${campaign.raised}</span></span>
                                                <span>Goal: <span className="campaignListGoal">${campaign.goal}</span></span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                    <button
                        className="button"
                        onClick={() => setActiveScreen('Support')}
                        style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                    >
                        <span className="buttonText">Back to Support Us</span>
                    </button>
                </div>
            );
        };

        const CampaignDetailsScreen = ({ showMessage, setActiveScreen, selectedCampaignId, currentUser }) => {
            const [campaign, setCampaign] = useState(null);
            const [loading, setLoading] = useState(true);
            const campaignImageRef = useRef(null); // Ref to the image element

            useEffect(() => {
                const fetchCampaignDetails = async () => {
                    if (!selectedCampaignId) {
                        showMessage("No campaign selected.");
                        setActiveScreen('AllCampaigns');
                        return;
                    }

                    try {
                        const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, selectedCampaignId);
                        const docSnap = await getDoc(campaignDocRef);

                        if (docSnap.exists()) {
                            setCampaign({ id: docSnap.id, ...docSnap.data() });
                        } else {
                            showMessage("Campaign not found.");
                            setActiveScreen('AllCampaigns');
                        }
                        setLoading(false);
                    } catch (error) {
                        console.error("Error fetching campaign details:", error);
                        showMessage("Failed to load campaign details. Please try again.");
                        setLoading(false);
                        setActiveScreen('AllCampaigns');
                    }
                };

                fetchCampaignDetails();
            }, [selectedCampaignId, setActiveScreen, showMessage]);

            const handleSupportCampaign = async () => {
                    if (!campaign) return;

                    if (!window.firebaseAuth.currentUser) { // Use window.firebaseAuth.currentUser for current user
                        showMessage("Please log in to support a campaign.");
                        setActiveScreen('Login'); // Redirect to login if not logged in
                        return;
                    }

                    const isEnded = new Date(campaign.endDate) < new Date();
                    if (isEnded) {
                        showMessage("This campaign has ended and can no longer receive donations.");
                        return;
                    }
                    if (campaign.status !== 'active') {
                        showMessage("This campaign is not yet active and cannot receive donations.");
                        return;
                    }

                    const donationAmount = 10; // Simulating a $10 donation for simplicity
                    const newRaisedAmount = (campaign.raised || 0) + donationAmount;

                    try {
                        // Update the campaign's raised amount
                        const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, campaign.id);
                        await updateDoc(campaignDocRef, {
                            raised: newRaisedAmount,
                            updatedAt: new Date().toISOString()
                        });

                        // Add a detailed donation record to the campaign's subcollection
                        const campaignDonationsRef = collection(db, `artifacts/${appId}/public/data/campaigns`, campaign.id, 'donations');
                        await addDoc(campaignDonationsRef, {
                            userId: window.firebaseAuth.currentUser.uid, // Use current user's UID
                            userName: window.firebaseAuth.currentUser.email.split('@')[0], // Use email prefix as donor name
                            amount: donationAmount,
                            timestamp: new Date().toISOString(),
                            campaignTitle: campaign.title,
                            campaignCreator: campaign.creatorName
                        });

                        setCampaign(prev => ({ ...prev, raised: newRaisedAmount })); // Optimistically update UI
                        showMessage(`Thank you for donating $${donationAmount} to "${campaign.title}"!`);
                    } catch (error) {
                        console.error("Error supporting campaign:", error);
                        showMessage(`Failed to process donation: ${error.message}. Please try again.`);
                    }
                };


            if (loading) {
                return (
                    <div className="screenContainer" style={{ textAlign: 'center', paddingTop: '50px' }}>
                        <p className="heading">Loading Campaign Details...</p>
                        <p className="subHeading" style={{ color: '#FFD700' }}>Please ensure you have an internet connection.</p>
                    </div>
                );
            }

            if (!campaign) {
                return null;
            }

            const progressPercentage = (campaign.raised / campaign.goal) * 100;
            const isCampaignEnded = new Date(campaign.endDate) < new Date();
            const daysRemaining = Math.ceil((new Date(campaign.endDate).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24));
            const isCampaignActive = campaign.status === 'active' && !isCampaignEnded;


            return (
                <div className="screenContainer">
                    <div className="campaignDetailHeader">
                        <img
                            ref={campaignImageRef}
                            src={campaign.imageUrl}
                            alt={campaign.title}
                            className="campaignDetailImage"
                            onError={(e) => { e.target.style.display = 'none'; }} /* Hide image if it fails to load */
                            style={{ display: campaign.imageUrl ? 'block' : 'none' }} /* Initially hide if no imageUrl */
                        />
                        <p className="campaignDetailTitle">
                            {campaign.title}
                            {isCampaignEnded && <span style={{color: '#DC3545', fontSize: '16px', marginLeft: '10px'}}>(Ended)</span>}
                            {!isCampaignEnded && campaign.status === 'pending' && <span style={{color: '#FFD700', fontSize: '16px', marginLeft: '10px'}}>(Pending Review)</span>}
                            {!isCampaignEnded && campaign.status === 'rejected' && <span style={{color: '#DC3545', fontSize: '16px', marginLeft: '10px'}}>(Rejected)</span>}
                            {!isCampaignEnded && campaign.status === 'active' && <span style={{color: '#00FF00', fontSize: '16px', marginLeft: '10px'}}>(Active)</span>}
                            {!isCampaignEnded && campaign.status === 'cancelled' && <span style={{color: '#888', fontSize: '16px', marginLeft: '10px'}}>(Cancelled)</span>}
                        </p>
                        <div className="campaignDetailCreator">
                            <img
                                src={campaign.creatorProfilePictureUrl || 'https://placehold.co/100x100/555/FFF?text=Profile'}
                                alt={campaign.creatorName}
                                className="campaignDetailCreatorProfilePic"
                                onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/32x32/555/FFF?text=P'; }}
                            />
                            <span>by {campaign.creatorName}</span>
                        </div>
                    </div>

                    <p className="campaignDetailDescription">{campaign.description}</p>

                    <div className="campaignDetailStats">
                        <div className="campaignDetailStatItem">
                            <p className="campaignDetailStatValue">${campaign.raised}</p>
                            <p>Raised</p>
                        </div>
                        <div className="campaignDetailStatItem">
                            <p className="campaignDetailStatValue">${campaign.goal}</p>
                            <p>Goal</p>
                        </div>
                        <div className="campaignDetailStatItem">
                            <p className="campaignDetailStatValue">{Math.round(progressPercentage)}%</p>
                            <p>Progress</p>
                        </div>
                    </div>
                    <div className="campaignDetailProgressBarContainer">
                        <div className="campaignDetailProgressBar" style={{ width: `${progressPercentage}%` }}></div>
                    </div>

                    {isCampaignEnded ? (
                        <p className="smallText" style={{ textAlign: 'center', color: '#DC3545', marginTop: '10px' }}>
                            This campaign ended on {new Date(campaign.endDate).toLocaleDateString()}.
                        </p>
                    ) : (
                        <p className="smallText" style={{ textAlign: 'center', color: '#00FF00', marginTop: '10px' }}>
                            {daysRemaining > 0 ? `${daysRemaining} days remaining` : 'Campaign ending soon!'}
                        </p>
                    )}


                    <button
                        className="button"
                        onClick={handleSupportCampaign}
                        disabled={!isCampaignActive} // Only active campaigns can be supported
                        style={!isCampaignActive ? { backgroundColor: '#555', cursor: 'not-allowed' } : {}}
                    >
                        <span className="buttonText">{isCampaignEnded ? 'Campaign Ended' : (campaign.status === 'pending' ? 'Pending Review' : (campaign.status === 'rejected' ? 'Campaign Rejected' : (campaign.status === 'cancelled' ? 'Campaign Cancelled' : 'Support This Campaign')))}</span>
                    </button>

                    {campaign.imageUrl && (
                        <button
                            className="button"
                            onClick={() => window.open(campaign.imageUrl, '_blank')}
                            style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '10px' }}
                        >
                            <span className="buttonText">Visit Project Link</span>
                        </button>
                    )}

                    <button
                        className="button"
                        onClick={() => setActiveScreen('AllCampaigns')}
                        style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                    >
                        <span className="buttonText">Back to All Campaigns</span>
                    </button>
                </div>
            );
        };

        // AdminDashboardScreen Component
        const AdminDashboardScreen = ({ showMessage, setActiveScreen, currentUser, setSelectedAdminCampaignId, creatorProfile }) => {
            // State variables for managing the expanded/collapsed state of each section.
            // By default, all sections are set to 'true' (expanded) initially.
            // You can change this to 'false' if you prefer them collapsed on load.
            const [isUserManagementExpanded, setIsUserManagementExpanded] = useState(true);
            const [isPendingCampaignsExpanded, setIsPendingCampaignsExpanded] = useState(true);
            const [isActiveCampaignsExpanded, setIsActiveCampaignsExpanded] = useState(true);
            // For any future sections you add, you would declare a new state variable here:
            // const [isFutureSectionExpanded, setIsFutureSectionExpanded] = useState(true);

            /**
             * Toggles the expanded state of a given section.
             * @param {function} setterFunction - The useState setter function for the specific section's state.
             * @param {boolean} currentState - The current boolean state (true for expanded, false for collapsed).
             */
            const toggleSection = (setterFunction, currentState) => {
                setterFunction(!currentState); // Simply reverses the current state
            };

            const [pendingCampaigns, setPendingCampaigns] = useState([]);
            const [activeCampaigns, setActiveCampaigns] = useState([]); // New state for active campaigns
            const [allUsers, setAllUsers] = useState([]); // State for all users
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const campaignsCollectionRef = collection(db, `artifacts/${appId}/public/data/campaigns`);

                // Fetch pending campaigns
                const qPending = query(
                    campaignsCollectionRef,
                    where('status', '==', 'pending'),
                    orderBy('createdAt', 'asc')
                );
                const unsubscribePending = onSnapshot(qPending, (snapshot) => {
                    const fetchedCampaigns = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setPendingCampaigns(fetchedCampaigns);
                }, (error) => {
                    console.error("Error fetching pending campaigns for admin:", error);
                    showMessage("Failed to load pending campaigns.");
                });

                // Fetch active campaigns
                const qActive = query(
                    campaignsCollectionRef,
                    where('status', '==', 'active'),
                    orderBy('createdAt', 'desc')
                );
                const unsubscribeActive = onSnapshot(qActive, (snapshot) => {
                    const fetchedCampaigns = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setActiveCampaigns(fetchedCampaigns);
                }, (error) => {
                    console.error("Error fetching active campaigns for admin:", error);
                    showMessage("Failed to load active campaigns.");
                });

                // Fetch all users
                const usersCollectionRef = collection(db, "creators");
                const unsubscribeUsers = onSnapshot(usersCollectionRef, (snapshot) => {
                    const fetchedUsers = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setAllUsers(fetchedUsers);
                    setLoading(false); // Set loading to false once all data is fetched
                }, (error) => {
                    console.error("Error fetching all users for admin:", error);
                    showMessage("Failed to load user data.");
                    setLoading(false); // Set loading to false on error
                });


                return () => {
                    unsubscribePending();
                    unsubscribeActive();
                    unsubscribeUsers();
                };
            }, [showMessage]); // Depend on showMessage to avoid linting warnings


            if (!currentUser || !creatorProfile || (creatorProfile.role !== 'admin' && creatorProfile.role !== 'authority')) {
                return (
                    <div className="screenContainer">
                        <p className="heading">Access Denied</p>
                        <p className="subHeading">You must be an Admin or Authority to view this dashboard.</p>
                        <button
                            className="button"
                            onClick={() => setActiveScreen('Login')}
                        >
                            <span className="buttonText">Go to Login</span>
                        </button>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className="screenContainer" style={{ textAlign: 'center', paddingTop: '50px' }}>
                        <p className="heading">Loading Admin Dashboard...</p>
                        <p className="subHeading" style={{ color: '#FFD700' }}>Please wait.</p>
                    </div>
                );
            }

            // Function to toggle ban status
            const toggleBan = async (userToBan) => {
                // Prevent an authority from banning an admin
                if (creatorProfile.role === 'authority' && userToBan.role === 'admin') {
                    showMessage("Authority users cannot ban Admin accounts.");
                    return;
                }
                // Prevent banning self
                if (userToBan.id === currentUser.uid) {
                    showMessage("You cannot ban or unban your own account.");
                    return;
                }

                try {
                    const userDocRef = doc(db, "creators", userToBan.id);
                    await updateDoc(userDocRef, {
                        banned: !userToBan.banned,
                        updatedAt: new Date().toISOString()
                    });
                    showMessage(`${userToBan.banned ? 'Unbanned' : 'Banned'} user: ${userToBan.creatorName || userToBan.email}`);
                } catch (error) {
                    console.error("Error toggling ban status:", error);
                    showMessage(`Failed to toggle ban status: ${error.message}`);
                }
            };

            // Filter users for display: Admins see all, Authorities see non-admins
            const usersToDisplay = allUsers.filter(user => {
                if (creatorProfile.role === 'admin') {
                    return true; // Admin sees all users
                } else if (creatorProfile.role === 'authority') {
                    return user.role !== 'admin'; // Authority sees all except admins
                }
                return false; // Should not happen due to initial access check
            });


            return (
                <div className="screenContainer">
                    <p className="heading">Admin Dashboard</p>
                    <p className="subHeading">Manage users and crowdfunding campaigns.</p>

                    {/* User Management Section */}
                    <section className="dashboardSection">
                        <div
                            className="flex justify-between items-center cursor-pointer py-2"
                            onClick={() => toggleSection(setIsUserManagementExpanded, isUserManagementExpanded)}
                            aria-expanded={isUserManagementExpanded}
                            aria-controls="user-management-content"
                        >
                            <p className="dashboardSectionTitle" style={{ marginBottom: '0' }}>User Management</p>
                            {/* Applied new class for the toggle button */}
                            <button className="admin-toggle-button">
                                {isUserManagementExpanded ? '&#x25BC;' : '&#x25B6;'}
                            </button>
                        </div>
                        <div
                            id="user-management-content"
                            className={`overflow-hidden transition-max-height duration-500 ease-in-out ${
                                isUserManagementExpanded ? 'max-h-screen' : 'max-h-0'
                            }`}
                        >
                            <div className="pt-4 border-t border-gray-200 mt-4" style={{ borderColor: '#3A3A3A' }}>
                                {usersToDisplay.length === 0 ? (
                                    <p className="dashboardItem">No users to display.</p>
                                ) : (
                                    <div className="dashboardContentList">
                                        {usersToDisplay.map(user => (
                                            <div key={user.id} className="adminDashboardItem">
                                                <div style={{ flexGrow: 1, marginRight: '10px' }}>
                                                    <p className="adminDashboardItemTitle">{user.creatorName || user.email}</p>
                                                    <p style={{ fontSize: '12px', color: '#CCC' }}>Role: {user.role}</p>
                                                    <p style={{ fontSize: '12px', color: user.banned ? '#DC3545' : '#00FF00' }}>Status: {user.banned ? 'Banned' : 'Active'}</p>
                                                    <p style={{ fontSize: '10px', color: '#AAA' }}>Last Login: {user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'N/A'}</p>
                                                    <p style={{ fontSize: '10px', color: '#AAA' }}>User ID: {user.id}</p> {/* Display full user ID */}
                                                </div>
                                                {currentUser.uid !== user.id && ( // Cannot ban self
                                                    <button
                                                        className={`adminActionButton ${user.banned ? 'reject' : 'approve'}`}
                                                        onClick={() => toggleBan(user)}
                                                    >
                                                        {user.banned ? 'Unban' : 'Ban'}
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Pending Campaigns Section */}
                    <section className="dashboardSection">
                        <div
                            className="flex justify-between items-center cursor-pointer py-2"
                            onClick={() => toggleSection(setIsPendingCampaignsExpanded, isPendingCampaignsExpanded)}
                            aria-expanded={isPendingCampaignsExpanded}
                            aria-controls="pending-campaigns-content"
                        >
                            <p className="dashboardSectionTitle" style={{ marginBottom: '0' }}>Pending Campaigns ({pendingCampaigns.length})</p>
                            {/* Applied new class for the toggle button */}
                            <button className="admin-toggle-button">
                                {isPendingCampaignsExpanded ? '&#x25BC;' : '&#x25B6;'}
                            </button>
                        </div>
                        <div
                            id="pending-campaigns-content"
                            className={`overflow-hidden transition-max-height duration-500 ease-in-out ${
                                isPendingCampaignsExpanded ? 'max-h-screen' : 'max-h-0'
                            }`}
                        >
                            <div className="pt-4 border-t border-gray-200 mt-4" style={{ borderColor: '#3A3A3A' }}>
                                {pendingCampaigns.length === 0 ? (
                                    <p className="dashboardItem">No campaigns currently pending review.</p>
                                ) : (
                                    <div className="dashboardContentList">
                                        {pendingCampaigns.map(campaign => (
                                            <div
                                                key={campaign.id}
                                                className="adminDashboardItem"
                                                onClick={() => {
                                                    setSelectedAdminCampaignId(campaign.id);
                                                    setActiveScreen('AdminCampaignDetails');
                                                }}
                                            >
                                                <div style={{ flexGrow: 1, marginRight: '10px' }}>
                                                    <p className="adminDashboardItemTitle">{campaign.title}</p>
                                                    <p style={{ fontSize: '12px', color: '#CCC' }}>by {campaign.creatorName}</p>
                                                    <p style={{ fontSize: '12px', color: '#AAA' }}>Goal: ${campaign.goal}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Active Campaigns Section for Admins */}
                    <section className="dashboardSection">
                        <div
                            className="flex justify-between items-center cursor-pointer py-2"
                            onClick={() => toggleSection(setIsActiveCampaignsExpanded, isActiveCampaignsExpanded)}
                            aria-expanded={isActiveCampaignsExpanded}
                            aria-controls="active-campaigns-content"
                        >
                            <p className="dashboardSectionTitle" style={{ marginBottom: '0' }}>Active Campaigns ({activeCampaigns.length})</p>
                            {/* Applied new class for the toggle button */}
                            <button className="admin-toggle-button">
                                {isActiveCampaignsExpanded ? '&#x25BC;' : '&#x25B6;'}
                            </button>
                        </div>
                        <div
                            id="active-campaigns-content"
                            className={`overflow-hidden transition-max-height duration-500 ease-in-out ${
                                isActiveCampaignsExpanded ? 'max-h-screen' : 'max-h-0'
                            }`}
                        >
                            <div className="pt-4 border-t border-gray-200 mt-4" style={{ borderColor: '#3A3A3A' }}>
                                {activeCampaigns.length === 0 ? (
                                    <p className="dashboardItem">No campaigns currently active.</p>
                                ) : (
                                    <div className="dashboardContentList">
                                        {activeCampaigns.map(campaign => (
                                            <div
                                                key={campaign.id}
                                                className="adminDashboardItem"
                                                onClick={() => {
                                                    setSelectedAdminCampaignId(campaign.id);
                                                    setActiveScreen('AdminCampaignDetails');
                                                }}
                                            >
                                                <div style={{ flexGrow: 1, marginRight: '10px' }}>
                                                    <p className="adminDashboardItemTitle">{campaign.title}</p>
                                                    <p style={{ fontSize: '12px', color: '#CCC' }}>by {campaign.creatorName}</p>
                                                    <p style={{ fontSize: '12px', color: '#AAA' }}>Goal: ${campaign.goal}</p>
                                                    <p style={{ fontSize: '12px', color: '#00FF00' }}>Status: Active</p> {/* Show active status */}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    <button
                        className="button"
                        onClick={() => setActiveScreen('Home')}
                        style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                    >
                        <span className="buttonText">Back to Home</span>
                    </button>
                </div>
            );
        };


        const ConfirmationModal = ({ title, message, onConfirm, onCancel }) => {
            return (
                <div className="confirmationModalOverlay">
                    <div className="confirmationModalContent">
                        <p className="confirmationModalTitle">{title}</p>
                        <p className="confirmationModalMessage">{message}</p>
                        <div className="confirmationModalButtons">
                            <button className="confirmationButton confirm" onClick={onConfirm}>Confirm</button>
                            <button className="confirmationButton cancel" onClick={onCancel}>Cancel</button>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminCampaignDetailsScreen = ({ showMessage, setActiveScreen, currentUser, selectedAdminCampaignId, setShowConfirmationModal, setConfirmationTitle, setConfirmationMessage, setOnConfirmationAction, creatorProfile }) => {
            const [campaign, setCampaign] = useState(null);
            const [loading, setLoading] = useState(true);
            const campaignImageRef = useRef(null);

            useEffect(() => {
                const fetchCampaignDetails = async () => {
                    if (!selectedAdminCampaignId) {
                        showMessage("No campaign selected for review.");
                        setActiveScreen('AdminDashboard');
                        return;
                    }

                    try {
                        const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, selectedAdminCampaignId);
                        const docSnap = await getDoc(campaignDocRef);

                        if (docSnap.exists()) {
                            setCampaign({ id: docSnap.id, ...docSnap.data() });
                        } else {
                            showMessage("Campaign not found.");
                            setActiveScreen('AdminDashboard');
                        }
                        setLoading(false);
                    } catch (error) {
                        console.error("Error fetching campaign details for admin review:", error);
                        showMessage("Failed to load campaign details for review. Please try again.");
                        setLoading(false);
                        setActiveScreen('AdminDashboard');
                    }
                };

                fetchCampaignDetails();
            }, [selectedAdminCampaignId, setActiveScreen, showMessage]);

            const confirmApprove = () => {
                // Check if current user is an authority and the campaign creator is an admin
                if (creatorProfile.role === 'authority' && campaign && campaign.creatorId) {
                    // Fetch the creator's role to check if they are an "admin"
                    // This is done via a separate getDoc call to respect Firestore rules that might prevent direct read of creator.role from request.resource
                    const creatorDocRef = doc(db, "creators", campaign.creatorId);
                    getDoc(creatorDocRef).then(docSnap => {
                        if (docSnap.exists() && docSnap.data().role === 'admin') {
                            showMessage("Authority users cannot approve campaigns created by Admin accounts.");
                            return;
                        } else {
                            setShowConfirmationModal(true);
                            setConfirmationTitle("Approve Campaign?");
                            setConfirmationMessage(`Are you sure you want to APPROVE campaign "${campaign.title}"?`);
                            setOnConfirmationAction(() => handleApproveCampaign);
                        }
                    }).catch(error => {
                        console.error("Error fetching creator role:", error);
                        showMessage("Could not verify campaign creator's role. Please try again.");
                    });
                } else {
                    setShowConfirmationModal(true);
                    setConfirmationTitle("Approve Campaign?");
                    setConfirmationMessage(`Are you sure you want to APPROVE campaign "${campaign.title}"?`);
                            setOnConfirmationAction(() => handleApproveCampaign);
                }
            };

            const handleApproveCampaign = async () => {
                setShowConfirmationModal(false); // Close modal
                if (!campaign || !currentUser) return;

                try {
                    const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, campaign.id);
                    await updateDoc(campaignDocRef, {
                        status: 'active',
                        approvedBy: currentUser.uid,
                        approvedAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    showMessage(`Campaign "${campaign.title}" approved successfully!`);
                    setActiveScreen('AdminDashboard'); // Go back to dashboard
                } catch (error) {
                    console.error("Error approving campaign:", error);
                    showMessage(`Failed to approve campaign: ${error.message}`);
                }
            };

            const confirmReject = () => {
                // Check if current user is an authority and the campaign creator is an admin
                if (creatorProfile.role === 'authority' && campaign && campaign.creatorId) {
                    const creatorDocRef = doc(db, "creators", campaign.creatorId);
                    getDoc(creatorDocRef).then(docSnap => {
                        if (docSnap.exists() && docSnap.data().role === 'admin') {
                            showMessage("Authority users cannot reject campaigns created by Admin accounts.");
                            return;
                        } else {
                            setShowConfirmationModal(true);
                            setConfirmationTitle("Reject Campaign?");
                            setConfirmationMessage(`Are you sure you want to REJECT campaign "${campaign.title}"?`);
                            setOnConfirmationAction(() => handleRejectCampaign);
                        }
                    }).catch(error => {
                        console.error("Error fetching creator role:", error);
                        showMessage("Could not verify campaign creator's role. Please try again.");
                    });
                } else {
                    setShowConfirmationModal(true);
                    setConfirmationTitle("Reject Campaign?");
                    setConfirmationMessage(`Are you sure you want to REJECT campaign "${campaign.title}"?`);
                    setOnConfirmationAction(() => handleRejectCampaign);
                }
            };

            const handleRejectCampaign = async () => {
                setShowConfirmationModal(false); // Close modal
                if (!campaign || !currentUser) return;

                try {
                    const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, campaign.id);
                    await updateDoc(campaignDocRef, {
                        status: 'rejected',
                        rejectedBy: currentUser.uid,
                        rejectedAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    showMessage(`Campaign "${campaign.title}" rejected.`);
                    setActiveScreen('AdminDashboard'); // Go back to dashboard
                } catch (error) {
                    console.error("Error rejecting campaign:", error);
                    showMessage(`Failed to reject campaign: ${error.message}`);
                }
            };

            const confirmEndCampaignByAdmin = () => {
                // Check if current user is an authority and the campaign creator is an admin
                if (creatorProfile.role === 'authority' && campaign && campaign.creatorId) {
                    const creatorDocRef = doc(db, "creators", campaign.creatorId);
                    getDoc(creatorDocRef).then(docSnap => {
                        if (docSnap.exists() && docSnap.data().role === 'admin') {
                            showMessage("Authority users cannot end campaigns created by Admin accounts.");
                            return;
                        } else {
                            setShowConfirmationModal(true);
                            setConfirmationTitle("End Campaign?");
                            setConfirmationMessage(`Are you sure you want to manually END campaign "${campaign.title}"? This will set its status to 'ended'.`);
                            setOnConfirmationAction(() => handleEndCampaignByAdmin);
                        }
                    }).catch(error => {
                        console.error("Error fetching creator role:", error);
                        showMessage("Could not verify campaign creator's role. Please try again.");
                    });
                } else {
                    setShowConfirmationModal(true);
                    setConfirmationTitle("End Campaign?");
                    setConfirmationMessage(`Are you sure you want to manually END campaign "${campaign.title}"? This will set its status to 'ended'.`);
                    setOnConfirmationAction(() => handleEndCampaignByAdmin);
                }
            };

            const handleEndCampaignByAdmin = async () => {
                setShowConfirmationModal(false); // Close modal
                if (!campaign || !currentUser) return;

                try {
                    const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, campaign.id);
                    await updateDoc(campaignDocRef, {
                        status: 'ended', // Set status to 'ended'
                        endedByAdmin: currentUser.uid, // Track admin who ended it
                        endedAt: new Date().toISOString(), // Use the current time as endedAt
                        updatedAt: new Date().toISOString()
                    });
                    showMessage(`Campaign "${campaign.title}" has been manually ended by admin.`);
                    setActiveScreen('AdminDashboard'); // Go back to dashboard after action
                } catch (error) {
                    console.error("Error ending campaign by admin:", error);
                    showMessage(`Failed to end campaign: ${error.message}`);
                }
            };

            if (loading) {
                return (
                    <div className="screenContainer" style={{ textAlign: 'center', paddingTop: '50px' }}>
                        <p className="heading">Loading Campaign Details for Review...</p>
                        <p className="subHeading" style={{ color: '#FFD700' }}>Please wait.</p>
                    </div>
                );
            }

            if (!campaign) {
                return null; // Should not happen if loading is false and campaignId is present
            }

            const createdDate = campaign.createdAt ? new Date(campaign.createdAt).toLocaleDateString() : 'N/A';
            const endDate = campaign.endDate ? new Date(campaign.endDate).toLocaleDateString() : 'N/A';

            return (
                <div className="screenContainer">
                    <p className="heading">Review Campaign</p>
                    <p className="subHeading">{campaign.title}</p>

                    <div className="dashboardSection">
                        <p className="dashboardSectionTitle">Campaign Details</p>
                        <div style={{ display: 'flex', alignItems: 'center', marginBottom: '15px' }}>
                            <img
                                src={campaign.creatorProfilePictureUrl || 'https://placehold.co/100x100/555/FFF?text=Profile'}
                                alt={campaign.creatorName}
                                style={{ width: '60px', height: '60px', borderRadius: '50%', objectFit: 'cover', marginRight: '15px', border: '2px solid #FFD700' }}
                                onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/60x60/555/FFF?text=P'; }}
                            />
                            <div>
                                <p className="dashboardItem" style={{ marginBottom: '0' }}>**Creator:** {campaign.creatorName}</p>
                                <p className="dashboardItem" style={{ fontSize: '12px', color: '#AAA' }}>Creator ID: {campaign.creatorId}</p>
                            </div>
                        </div>

                        <p className="dashboardItem">**Description:** {campaign.description}</p>
                        <p className="dashboardItem">**Funding Goal:** ${campaign.goal}</p>
                        <p className="dashboardItem">**Current Raised:** ${campaign.raised}</p>
                        <p className="dashboardItem">**Status:** <span style={{ color: campaign.status === 'pending' ? '#FFD700' : (campaign.status === 'active' ? '#00FF00' : (campaign.status === 'cancelled' ? '#888' : '#DC3545')) }}>{campaign.status}</span></p>
                        <p className="dashboardItem">**Created On:** {createdDate}</p>
                        <p className="dashboardItem">**Ends On:** {endDate}</p>

                        {campaign.imageUrl && (
                            <div style={{ marginTop: '15px' }}>
                                <p className="formLabel">Project Image/Link:</p>
                                <img
                                    ref={campaignImageRef}
                                    src={campaign.imageUrl}
                                    alt="Campaign Project"
                                    style={{ width: '100%', maxWidth: '300px', height: 'auto', borderRadius: '8px', objectFit: 'contain', marginTop: '10px' }}
                                    onError={(e) => { e.target.style.display = 'none'; showMessage('Project image failed to load.'); }}
                                />
                                <button
                                    className="button"
                                    onClick={() => window.open(campaign.imageUrl, '_blank')}
                                    style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '10px', width: 'auto', alignSelf: 'flex-start', padding: '8px 15px', fontSize: '14px' }}
                                >
                                    <span className="buttonText">Open Project Link in New Tab</span>
                                </button>
                            </div>
                        )}
                    </div>

                    <div style={{ display: 'flex', justifyContent: 'space-around', marginTop: '20px' }}>
                        {campaign.status === 'pending' && ( // Only show approve/reject for pending
                            <>
                                <button
                                    className="adminActionButton approve"
                                    onClick={confirmApprove}
                                >
                                    Approve Campaign
                                </button>
                                <button
                                    className="adminActionButton reject"
                                    onClick={confirmReject}
                                >
                                    Reject Campaign
                                </button>
                            </>
                        )}
                        {campaign.status === 'active' && ( // Show End button only for active campaigns
                            <button
                                className="adminActionButton"
                                onClick={confirmEndCampaignByAdmin}
                                style={{ backgroundColor: '#FF8C00' }} // Orange color for 'End Campaign'
                            >
                                End Campaign
                            </button>
                        )}
                    </div>

                    <button
                        className="button"
                        onClick={() => setActiveScreen('AdminDashboard')}
                        style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                    >
                        <span className="buttonText">Back to Admin Dashboard</span>
                    </button>
                </div>
            );
        };


        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeScreen, setActiveScreen] = useState('Home');

            const [activeCategory, setActiveCategory] = useState('Skits');
            const [message, setMessage] = useState('');
            const [showVideoModal, setShowVideoModal] = useState(false);
            const [currentVideoUrl, setCurrentVideoUrl] = useState('');

            const [showImageAdjustModal, setShowImageAdjustModal] = useState(false);
            const [imageFileToAdjust, setImageFileToAdjust] = useState(null);
            const [creatorProfile, setCreatorProfile] = useState(null);
            const [creatorCampaigns, setCreatorCampaigns] = useState([]); // State for all creator's campaigns

            const [selectedCampaignId, setSelectedCampaignId] = useState(null);
            // New state for admin-selected campaign details
            const [selectedAdminCampaignId, setSelectedAdminCampaignId] = useState(null);

            // New state variables for custom confirmation modal
            const [showConfirmationModal, setShowConfirmationModal] = useState(false);
            const [confirmationTitle, setConfirmationTitle] = useState('');
            const [confirmationMessage, setConfirmationMessage] = useState('');
            const [onConfirmationAction, setOnConfirmationAction] = useState(null);


            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, async (user) => {
                    setCurrentUser(user);
                    if (user) {
                        try {
                            const creatorDocRef = doc(db, "creators", user.uid);
                            const docSnap = await getDoc(creatorDocRef);
                            if (docSnap.exists()) {
                                const profileData = docSnap.data();
                                // Block banned users
                                if (profileData.banned) {
                                    showMessage("Your account has been banned. Please contact support.");
                                    await signOut(auth);
                                    setCurrentUser(null);
                                    setCreatorProfile(null);
                                    setActiveScreen('Home');
                                    return;
                                }
                                setCreatorProfile(profileData);
                                // Update lastLogin
                                await updateDoc(creatorDocRef, { lastLogin: new Date().toISOString() });
                            } else {
                                // New user, create profile with default role and not banned
                                await setDoc(creatorDocRef, {
                                    email: user.email,
                                    creatorName: user.email.split('@')[0] || "",
                                    bio: "",
                                    categories: [],
                                    existingWorkLink: "",
                                    profilePictureUrl: '',
                                    uploadedVideos: { youtube: null, facebook: null, tiktok: null },
                                    createdAt: new Date().toISOString(),
                                    role: 'user', // Default new users to 'user' role
                                    banned: false // Default new users to not be banned
                                });
                                const newDocSnap = await getDoc(creatorDocRef);
                                if(newDocSnap.exists()) {
                                    setCreatorProfile(newDocSnap.data());
                                }
                            }
                        } catch (error) {
                            console.error("Error fetching/creating creator profile on auth state change:", error);
                            showMessage("Error loading profile data.");
                        }
                    } else {
                        setCreatorProfile(null);
                    }
                });
                return () => unsubscribe();
            }, []);

            // New useEffect to fetch ALL of creator's campaigns for dashboard
            useEffect(() => {
                let unsubscribe = () => {};
                if (currentUser) {
                    const campaignsCollectionRef = collection(db, `artifacts/${appId}/public/data/campaigns`);
                    // Fetch all campaigns by this creator, ordered by creation date
                    const q = query(
                        campaignsCollectionRef,
                        where('creatorId', '==', currentUser.uid),
                        orderBy('createdAt', 'desc')
                    );

                    unsubscribe = onSnapshot(q, (snapshot) => {
                        const fetchedCampaigns = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setCreatorCampaigns(fetchedCampaigns);
                    }, (error) => {
                        console.error("Error fetching creator's campaigns:", error);
                        setCreatorCampaigns([]); // Clear campaigns on error
                    });
                } else {
                    setCreatorCampaigns([]); // Clear campaigns if no user
                }

                return () => unsubscribe(); // Cleanup listener
            }, [currentUser]); // Re-run when currentUser changes


            const originalCarouselImages = [
                'https://placehold.co/140x100/A0A0A0/000?text=Comedy+Night',
                'https://placehold.co/140x100/808080/FFF?text=New+Series',
                'https://placehold.co/140x100/606060/EEE?text=Exclusive',
                'https://placehold.co/140x100/404040/DDD?text=Behind+Scenes',
                'https://placehold.co/140x100/202020/CCC?text=Live+Event',
            ];
            const carouselImages = [...originalCarouselImages, ...originalCarouselImages, ...originalCarouselImages];

            const originalLiveFeedContent = [
                { id: 'lf1', title: 'New Comedy Skit: Dem Boys', creator: 'Street Jokes GY', thumbnail: 'https://placehold.co/80x60/808080/FFF?text=Skit1', url: 'https://www.youtube.com/embed/SKIT_LIVE_1?autoplay=1' },
                { id: 'lf2', title: 'Interview: Rising Star', creator: 'NVA Insights', thumbnail: 'https://placehold.co/80x60/A0A0A0/000?text=Int1', url: 'https://www.youtube.com/embed/INTERVIEW_LIVE_2?autoplay=1' },
                { id: 'lf3', title: 'Short Film Trailer: Lost Gold', creator: 'Guyana Films', thumbnail: 'https://placehold.co/80x60/606060/EEE?text=Film1', url: 'https://www.youtube.com/embed/FILM_LIVE_3?autoplay=1' },
                { id: 'lf4', title: 'Live Music Session: Reggae Vibes', creator: 'Riddim Makers', thumbnail: 'https://placehold.co/80x60/404040/DDD?text=Music1', url: 'https://www.youtube.com/embed/MUSIC_LIVE_4?autoplay=1' },
                { id: 'lf5', title: 'Behind The Scenes: Drama Shoot', creator: 'Creative Minds', thumbnail: 'https://placehold.co/80x60/202020/CCC?text=BTS1', url: 'https://www.youtube.com/embed/BTS_LIVE_5?autoplay=1' },
                { id: 'lf6', title: 'Daily Vlog: Life in Georgetown', creator: 'GT Vlogger', thumbnail: 'https://placehold.co/80x60/909090/111?text=Vlog1', url: 'https://www.youtube.com/embed/VLOG_LIVE_6?autoplay=1' },
            ];
            const liveFeedItems = [...originalLiveFeedContent, ...originalLiveFeedContent, ...originalLiveFeedContent];


            const showMessage = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(''), 3000);
            };

            const handleVideoPress = (url) => {
                setCurrentVideoUrl(url);
                setShowVideoModal(true);
            };

            const closeVideoModal = () => {
                setShowVideoModal(false);
                setCurrentVideoUrl('');
            };

            const handleLogout = async () => {
                try {
                    await signOut(auth);
                    showMessage('Logged out successfully!');
                    setActiveScreen('Home');
                } catch (error) {
                    console.error("Error logging out:", error);
                    showMessage('Failed to log out. Please try again.');
                }
            };

            const HomeScreen = () => {
                const horizontalCarouselRef = useRef(null);
                const horizontalScrollIntervalRef = useRef(null);
                const [isHorizontalDragging, setIsHorizontalDragging] = useState(false);
                const [horizontalStartX, setHorizontalStartX] = useState(0);
                const [horizontalScrollLeft, setHorizontalScrollLeft] = useState(0);

                const verticalCarouselRef = useRef(null);
                const verticalScrollIntervalRef = useRef(null);
                const [isVerticalDragging, setIsVerticalDragging] = useState(false);
                const [verticalStartY, setVerticalStartY] = useState(0);
                const [verticalScrollTop, setVerticalScrollTop] = useState(0);

                const startHorizontalAutoScroll = () => {
                    if (horizontalScrollIntervalRef.current) clearInterval(horizontalScrollIntervalRef.current);
                    const carousel = horizontalCarouselRef.current;
                    if (!carousel) return;

                    let scrollAmountPerItem = 0;
                    const firstItem = carousel.querySelector('.horizontal-carousel-item');
                    if (firstItem) {
                        const itemWidth = firstItem.offsetWidth;
                        const itemMarginRight = parseFloat(window.getComputedStyle(firstItem).marginRight);
                        scrollAmountPerItem = itemWidth + itemMarginRight;
                    } else {
                        scrollAmountPerItem = (carousel.offsetWidth / 3) + 15;
                    }
                    const originalContentWidth = originalCarouselImages.length * scrollAmountPerItem;

                    horizontalScrollIntervalRef.current = setInterval(() => {
                        if (isHorizontalDragging) return;
                        if (carousel.scrollLeft >= originalContentWidth - (scrollAmountPerItem / 2)) {
                            carousel.scrollLeft = 0;
                        }
                        carousel.scrollBy({ left: scrollAmountPerItem, behavior: 'smooth' });
                    }, 3000);
                };

                const stopHorizontalAutoScroll = () => {
                    if (horizontalScrollIntervalRef.current) clearInterval(horizontalScrollIntervalRef.current);
                    horizontalScrollIntervalRef.current = null;
                };

                useEffect(() => {
                    startHorizontalAutoScroll();
                    const carousel = horizontalCarouselRef.current;
                    if (!carousel) return;
                    carousel.addEventListener('mouseenter', stopHorizontalAutoScroll);
                    carousel.addEventListener('mouseleave', startHorizontalAutoScroll);
                    return () => {
                        stopHorizontalAutoScroll();
                        carousel.removeEventListener('mouseenter', stopHorizontalAutoScroll);
                        carousel.removeEventListener('mouseleave', startHorizontalAutoScroll);
                    };
                }, [isHorizontalDragging]);

                const handleHorizontalTouchStart = (e) => {
                    stopHorizontalAutoScroll();
                    setIsHorizontalDragging(true);
                    setHorizontalStartX(e.touches[0].pageX - horizontalCarouselRef.current.offsetLeft);
                    setHorizontalScrollLeft(horizontalCarouselRef.current.scrollLeft);
                };

                const handleHorizontalTouchMove = (e) => {
                    if (!isHorizontalDragging) return;
                    e.preventDefault();
                    const x = e.touches[0].pageX - horizontalCarouselRef.current.offsetLeft;
                    const walk = (x - horizontalStartX) * 1.5;
                    horizontalCarouselRef.current.scrollLeft = horizontalScrollLeft - walk;
                };

                const handleHorizontalTouchEnd = () => {
                    setIsHorizontalDragging(false);
                    setTimeout(startHorizontalAutoScroll, 1500);
                };

                const startVerticalAutoScroll = () => {
                    if (verticalScrollIntervalRef.current) clearInterval(verticalScrollIntervalRef.current);
                    const carousel = verticalCarouselRef.current;
                    if (!carousel) return;

                    let scrollAmountPerItem = 0;
                    const firstItem = carousel.querySelector('.vertical-carousel-item');
                    if (firstItem) {
                        const itemHeight = firstItem.offsetHeight;
                        const itemMarginBottom = parseFloat(window.getComputedStyle(firstItem).marginBottom);
                        scrollAmountPerItem = itemHeight + itemMarginBottom;
                    } else {
                        // Fallback if no items are rendered yet, estimate based on container height
                        scrollAmountPerItem = (carousel.offsetHeight / 2) + 15; // Roughly half height + margin
                    }

                    // Correctly calculate originalContentHeight for vertical carousel
                    const originalContentHeight = originalLiveFeedContent.length * scrollAmountPerItem;

                    verticalScrollIntervalRef.current = setInterval(() => {
                        if (isVerticalDragging) return;

                        if (carousel.scrollTop >= originalContentHeight - (scrollAmountPerItem / 2)) {
                             carousel.scrollTop = 0;
                        }
                        carousel.scrollBy({ top: scrollAmountPerItem, behavior: 'smooth' });
                    }, 3000);
                };

                const stopVerticalAutoScroll = () => {
                    if (verticalScrollIntervalRef.current) clearInterval(verticalScrollIntervalRef.current);
                    verticalScrollIntervalRef.current = null;
                };

                 useEffect(() => {
                    startVerticalAutoScroll();

                    const carousel = verticalCarouselRef.current;
                    if (!carousel) return;

                    carousel.addEventListener('mouseenter', stopVerticalAutoScroll);
                    carousel.addEventListener('mouseleave', startVerticalAutoScroll);

                    return () => {
                        stopVerticalAutoScroll();
                        carousel.removeEventListener('mouseenter', stopVerticalAutoScroll);
                        carousel.removeEventListener('mouseleave', startVerticalAutoScroll);
                    };
                }, [isVerticalDragging]);

                const handleVerticalTouchStart = (e) => {
                    stopVerticalAutoScroll();
                    setIsVerticalDragging(true);
                    setVerticalStartY(e.touches[0].pageY - verticalCarouselRef.current.offsetTop);
                    setVerticalScrollTop(verticalCarouselRef.current.scrollTop);
                };

                const handleVerticalTouchMove = (e) => {
                    if (!isVerticalDragging) return;
                    e.preventDefault();
                    const y = e.touches[0].pageY - verticalStartY;
                    const walk = (y - verticalStartY) * 1.5;
                    verticalCarouselRef.current.scrollTop = verticalScrollTop - walk;
                };

                const handleVerticalTouchEnd = () => {
                    setIsVerticalDragging(false);
                    setTimeout(startVerticalAutoScroll, 1500);
                };


                return (
                    <div className="screenContainer">
                        <div className="topRightButtonContainer">
                            {/* New "Support Us" button */}
                            <button
                                className="topButton"
                                onClick={() => setActiveScreen('Support')}
                            >
                                Support Us
                            </button>
                            {currentUser ? (
                                <button
                                    className="topButton"
                                    onClick={handleLogout}
                                >
                                    Logout
                                </button>
                            ) : (
                                <button
                                    className="topButton"
                                    onClick={() => setActiveScreen('Login')}
                                >
                                    Login
                                </button>
                            )}
                        </div>

                        <p className="sectionTitle">Featured Highlights</p>
                        <div
                            className="horizontal-carousel-container"
                            ref={horizontalCarouselRef}
                            onTouchStart={handleHorizontalTouchStart}
                            onTouchMove={handleHorizontalTouchMove}
                            onTouchEnd={handleHorizontalTouchEnd}
                        >
                            {carouselImages.map((imageUrl, index) => (
                                <div key={index} className="horizontal-carousel-item">
                                    <img src={imageUrl} alt={`Carousel Image ${index + 1}`} className="carousel-image" />
                                </div>
                            ))}
                        </div>

                        <div className="sectionHeaderWithButton">
                            <p className="sectionTitle" style={{ marginBottom: '0' }}>Trending</p>
                            {!currentUser && (
                                <button
                                    className="sectionHeaderButton"
                                    onClick={() => setActiveScreen('CreatorSignUp')}
                                >
                                    Creator Sign Up
                                </button>
                            )}
                        </div>
                        <div className="contentGrid">
                            {featuredContent.slice(0, 6).map((item) => (
                                <button key={item.id} className="contentCard" onClick={() => handleVideoPress(item.url)}>
                                    <div className="thumbnailPlaceholder">
                                        <p className="thumbnailText">Video Thumbnail</p>
                                        <svg className="playIcon" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z"/>
                                        </svg>
                                    </div>
                                    <p className="contentTitle">{item.title}</p>
                                </button>
                            ))}
                        </div>

                        <div className="sectionHeaderWithButton"> {/* New container for Live Feed title and Discover button */}
                            <p className="sectionTitle" style={{ marginBottom: '0' }}>Live Feed</p>
                            <button className="sectionHeaderButton" onClick={() => setActiveScreen('Discover')}>
                                Discover All
                            </button>
                        </div>
                        <div
                            className="vertical-carousel-container"
                            ref={verticalCarouselRef}
                            onTouchStart={handleVerticalTouchStart}
                            onTouchMove={handleVerticalTouchMove}
                            onTouchEnd={handleVerticalTouchEnd}
                        >
                            {liveFeedItems.map((item, index) => (
                                <button key={index} className="vertical-carousel-item" onClick={() => handleVideoPress(item.url)}>
                                    <img src={item.thumbnail} alt={item.title} className="liveFeedThumbnail" />
                                    <div className="liveFeedContent">
                                        <p className="liveFeedTitle">{item.title}</p>
                                        <p className="liveFeedCreator">by {item.creator}</p>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            const CategoriesScreen = () => (
                <div className="screenContainer">
                    <div className="categoryTabs">
                        {Object.keys(categories).map((categoryName) => (
                            <button
                                key={categoryName}
                                className={`categoryTab ${activeCategory === categoryName ? 'activeCategoryTab' : ''}`}
                                onClick={() => setActiveCategory(categoryName)}
                            >
                                <span className={`categoryTabText ${activeCategory === categoryName ? 'activeCategoryTabText' : ''}`}>
                                    {categoryName}
                                </span>
                            </button>
                        ))}
                    </div>

                    <div className="categoryContent">
                        <p className="sectionTitle">{activeCategory} Content</p>
                        <div className="contentGrid">
                            {categories[activeCategory].map((item) => (
                                <button key={item.id} className="contentCard" onClick={() => handleVideoPress(item.url)}>
                                    <div className="thumbnailPlaceholder">
                                        <p className="thumbnailText">Video Thumbnail</p>
                                        <svg className="playIcon" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z"/>
                                        </svg>
                                    </div>
                                    <p className="contentTitle">{item.title}</p>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const PremiumScreen = () => (
                <div className="screenContainer">
                    <p className="heading">Unlock NVA Network Premium!</p>
                    <p className="subHeading">Experience Guyanese content like never before.</p>

                    <div className="premiumFeatureCard">
                        <p className="premiumFeatureTitle">1. Exclusive Content Access</p>
                        <p className="premiumFeatureDescription">
                            Get early access to new shows, premium-only series, uncensored versions,
                            and exclusive live events. Example: "Watch the full uncut version of Vibes Unfiltered before anyone else!"
                        </p>
                    </div>

                    <div className="premiumFeatureCard">
                        <p className="premiumFeatureTitle">2. Ad-Free Viewing</p>
                        <p className="premiumFeatureDescription">
                            Enjoy a seamless, uninterrupted viewing experience without in-app banner ads or pre-roll ads.
                        </p>
                    </div>

                    <div className="premiumFeatureCard">
                        <p className="premiumFeatureTitle">3. Special Perks & Giveaways</p>
                        <p className="premiumFeatureDescription">
                            Participate in monthly giveaways, exclusive merch drops, coupon codes for local businesses,
                            and priority access to virtual meet & greets.
                        </p>
                    </div>
                    <div className="premiumFeatureCard">
                        <p className="premiumFeatureTitle">5. Downloadable/Offline Viewing (Future)</p>
                        <p className="premiumFeatureDescription">
                            (Coming Soon) Download original content to watch offline, perfect for inconsistent internet.
                        </p>
                    </div>

                    <p className="sectionTitle">Pricing:</p>
                    <div className="pricingTable">
                        <div className="pricingRow">
                            <p className="pricingTier">Free</p>
                            <p className="pricingFeatures">Public videos, live shows, ads</p>
                            <p className="pricingPrice">$0</p>
                        </div>
                        <div className="pricingRow">
                            <p className="pricingTier">Premium Monthly</p>
                            <p className="pricingFeatures">All perks above</p>
                            <p className="pricingPrice">$1.99 USD / ~$400 GYD</p>
                        </div>
                        <div className="pricingRow">
                            <p className="pricingTier">Premium Yearly</p>
                            <p className="pricingFeatures">Discounted + bonus perks</p>
                            <p className="pricingPrice">$20 USD / ~$4,000 GYD</p>
                        </div>
                    </div>
                    <p className="smallText">
                        (Note: Actual payment integration would be done here using services like Stripe/PayPal.)
                    </p>
                    <button
                        className="button"
                        onClick={() => showMessage('Simulating subscription purchase. In a real app, this would initiate payment.')}
                    >
                        <span className="buttonText">Subscribe Now!</span>
                    </button>
                </div>
            );

            const AboutContactScreen = () => (
                <div className="screenContainer">
                    <p className="heading">About NVA Network</p>
                    <p className="subHeading">The Caribbeans first mobile-first entertainment network, dedicated to bringing the best of Guyanese content to a global stage.</p>

                    <p className="paragraph">
                        NVA Network is committed to empowering local creators and connecting audiences worldwide
                        with unique and vibrant stories from Guyana. Our mission is to provide a platform for Guyanese
                        comedians, filmmakers, interviewers, and live event organizers to showcase their talent,
                        reach new audiences, and build sustainable careers.
                    </p>

                    <p className="sectionTitle">Contact Us</p>
                    <p className="paragraph">
                        Have questions, feedback, or want to partner with us? Reach out!
                    </p>
                    <p className="contactInfo">Email: contact@nvanetwork.gy</p>
                    <p className="contactInfo">Phone: +592-555-NVA (Placeholder)</p>
                    <p className="contactInfo">Follow us on social media!</p>
                </div>
            );

            const CrowdfundingScreen = ({ showMessage, setActiveScreen }) => (
                <div className="screenContainer">
                    <p className="heading">Support Guyanese Creators!</p>
                    <p className="subHeading">Help bring more authentic Guyanese content to life.</p>

                    <p className="paragraph">
                        International crowdfunding platforms often don't support direct bank accounts in Guyana,
                        making it difficult for our talented creators to receive global support.
                        At NVA Network, we're committed to finding direct ways for you to contribute!
                    </p>

                    <div className="premiumFeatureCard">
                        <p className="premiumFeatureTitle">Why Your Support Matters:</p>
                        <p className="premiumFeatureDescription">
                            Your contributions directly fund new skits, short films, interviews, and live event coverage.
                            Every dollar helps cover production costs, equipment, and fair compensation for our artists.
                        </p>
                    </div>

                    <p className="sectionTitle">How You Can Contribute Directly:</p>
                    <p className="paragraph">
                        We are setting up direct support channels that are accessible within Guyana and for our diaspora.
                        Please contact us for details on how to send your support via:
                    </p>
                    <p className="listItem"> Direct Bank Transfer (Local & International options)</p>
                    <p className="listItem"> Mobile Money Services (e.g., MMG - Mobile Money Guyana)</p>
                    <p className="listItem"> Other Local Payment Methods</p>

                    <button
                        className="button"
                        onClick={() => setActiveScreen('AllCampaigns')}
                    >
                        <span className="buttonText">Browse Creator Campaigns</span>
                    </button>
                    <p className="smallText">
                        (Discover campaigns and support your favorite creators!)
                    </p>

                    <p className="paragraph" style={{ marginTop: '20px' }}>
                        Your generosity empowers Guyanese voices and helps us build a stronger, more vibrant content ecosystem.
                        Thank you for being a part of the NVA Network family!
                    </p>

                    <p className="smallText" style={{ marginTop: '20px', color: '#888' }}>
                        A small platform fee (e.g., 5%) helps NVA Network cover operational costs and continue supporting our creators.
                    </p>
                </div>
            );


            const CreatorSignUpScreen = ({ showMessage, setActiveScreen }) => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [creatorName, setCreatorName] = useState('');
                const [bio, setBio] = useState('');
                const [selectedCategories, setSelectedCategories] = useState([]);
                const [existingWorkLink, setExistingWorkLink] = useState('');
                const [agreedToTerms, setAgreedToTerms] = useState(false);

                const availableCategories = ['Skits', 'Short Films', 'Interviews', 'Live Premieres', 'Music', 'Documentary', 'Other'];

                const handleCategoryChange = (e) => {
                    const { value, checked } = e.target;
                    if (checked) {
                        setSelectedCategories((prev) => [...prev, value]);
                    } else {
                        setSelectedCategories((prev) => prev.filter((cat) => cat !== value));
                    }
                };

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    if (!agreedToTerms) {
                        showMessage('Please agree to the Creator Terms & Conditions to sign up.');
                        return;
                    }

                    if (password.length < 8) {
                        showMessage('Password must be at least 8 characters long.');
                        return;
                    }
                    if (!/\d/.test(password)) {
                        showMessage('Password must include at least one number.');
                        return;
                    }
                    if (!/[A-Z]/.test(password)) {
                        showMessage('Password must include at least one capital letter.');
                        return;
                    }

                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;

                        const creatorRef = doc(db, "creators", user.uid);
                        await setDoc(creatorRef, {
                            email: user.email,
                            creatorName: creatorName,
                            bio: bio,
                            categories: selectedCategories,
                            existingWorkLink: existingWorkLink,
                            profilePictureUrl: '',
                            uploadedVideos: { youtube: null, facebook: null, tiktok: null },
                            createdAt: new Date().toISOString(),
                            role: 'user', // Default new users to 'user' role
                            banned: false // Default new users to not be banned
                        });

                        showMessage(`Creator "${creatorName}" signed up successfully! (User created in Firebase)`);
                        setActiveScreen('CreatorDashboard');
                    }
                    catch (error) {
                        console.error("Error signing up creator:", error);
                        let errorMessage = "Failed to sign up. Please try again.";
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = "This email is already in use. Please use a different email or sign in.";
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = "Invalid email address format.";
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = "Password is too weak. Please choose a stronger password.";
                        } else if (error.code === 'auth/network-request-failed') {
                            errorMessage = "Network error. Please check your internet connection.";
                        } else if (error.code === 'auth/operation-not-allowed') {
                            errorMessage = "Email/Password sign-in is not enabled. Please enable it in Firebase Console.";
                        } else if (error.code === 'auth/missing-or-invalid-nonce') {
                            errorMessage = "Sign-up session expired or invalid. Please refresh the page and try again.";
                        }
                        showMessage(errorMessage);
                    }
                };

                return (
                    <div className="screenContainer">
                        <p className="heading">Join NVA Network as a Creator!</p>
                        <p className="subHeading">Create your profile to share your talent and connect with your audience.</p>

                        <form onSubmit={handleSubmit}>
                            <div className="formGroup">
                                <label htmlFor="email" className="formLabel">Email:</label>
                                <input
                                    type="email"
                                    id="email"
                                    className="formInput"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>

                            <div className="formGroup">
                                <label htmlFor="password" className="formLabel">Password:</label>
                                <input
                                    type="password"
                                    id="password"
                                    className="formInput"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                                <p className="smallText" style={{ textAlign: 'left', color: '#FFD700', marginTop: '5px' }}>
                                    Password must be at least 8 characters long, include at least one number and one capital letter.
                                </p>
                            </div>

                            <div className="formGroup">
                                <label htmlFor="creatorName" className="formLabel">Creator Name (Public):</label>
                                <input
                                    type="text"
                                    id="creatorName"
                                    className="formInput"
                                    value={creatorName}
                                    onChange={(e) => setCreatorName(e.target.value)}
                                    required
                                />
                            </div>

                            <div className="formGroup">
                                <label htmlFor="bio" className="formLabel">Brief Bio/Description:</label>
                                <textarea
                                    id="bio"
                                    className="formTextarea"
                                    value={bio}
                                    onChange={(e) => setBio(e.target.value)}
                                    placeholder="Tell us about yourself and your content!"
                                    required
                                ></textarea>
                            </div>

                            <div className="checkboxGroup">
                                <p className="checkboxLabel">Content Categories:</p>
                                {availableCategories.map((cat) => (
                                    <div key={cat} className="checkboxItem">
                                        <input
                                            type="checkbox"
                                            id={`cat-${cat}`}
                                            value={cat}
                                            checked={selectedCategories.includes(cat)}
                                            onChange={handleCategoryChange}
                                        />
                                        <label htmlFor={`cat-${cat}`}>{cat}</label>
                                    </div>
                                ))}
                            </div>

                            <div className="formGroup">
                                <label htmlFor="existingWork" className="formLabel">Link to Existing Work (Optional):</label>
                                <input
                                    type="url"
                                    id="existingWork"
                                    className="formInput"
                                    value={existingWorkLink}
                                    onChange={(e) => setExistingWorkLink(e.target.value)}
                                    placeholder="e.g., YouTube channel, Instagram profile"
                                />
                            </div>

                            <div className="formGroup">
                                <div className="checkboxItem">
                                    <input
                                        type="checkbox"
                                        id="agreeTerms"
                                        checked={agreedToTerms}
                                        onChange={(e) => setAgreedToTerms(e.target.checked)}
                                        required
                                    />
                                    <label htmlFor="agreeTerms">
                                        I agree to the <a href="#" className="termsLink" onClick={(e) => { e.preventDefault(); showMessage('Simulating opening Creator Terms & Conditions...'); }}>Creator Terms & Conditions</a>.
                                    </label>
                                </div>
                                <p className="termsText">
                                    NVA Network retains a **5-10% platform fee** from all crowdfunding and monetization activities
                                    to support platform operations, development, and continued promotion of Guyanese content.
                                    Detailed terms are in the full agreement.
                                </p>
                            </div>

                            <button type="submit" className="button">
                                <span className="buttonText">Sign Up as Creator</span>
                            </button>
                        </form>

                        <button
                            className="button"
                            onClick={() => setActiveScreen('Home')}
                            style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                        >
                            <span className="buttonText">Back to Home</span>
                        </button>
                    </div>
                );
            };

            const LoginScreen = ({ showMessage, setActiveScreen }) => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        showMessage(`Logged in as ${email}!`);
                        setActiveScreen('CreatorDashboard');
                    } catch (error) {
                        console.error("Error logging in:", error);
                        let errorMessage = "Login failed. Please check your credentials.";
                        if (error.code === 'auth/user-not-found') {
                            errorMessage = "No account found with that email. Please sign up or check your email.";
                        } else if (error.code === 'auth/wrong-password') {
                            errorMessage = "Incorrect password. Please try again.";
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = "Invalid email address format.";
                        } else if (error.code === 'auth/network-request-failed') {
                            errorMessage = "Network error. Please check your internet connection.";
                        } else if (error.code === 'auth/too-many-requests') {
                            errorMessage = "Too many login attempts. Please try again later.";
                        }
                        showMessage(errorMessage);
                    }
                };

                return (
                    <div className="screenContainer">
                        <p className="heading">Creator Login</p>
                        <p className="subHeading">Access your dashboard to manage your content and campaigns.</p>

                        <form onSubmit={handleSubmit} className="loginForm">
                            <div className="formGroup">
                                <label htmlFor="loginEmail" className="formLabel">Email:</label>
                                <input
                                    type="email"
                                    id="loginEmail"
                                    className="formInput"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>

                            <div className="formGroup">
                                <label htmlFor="loginPassword" className="formLabel">Password:</label>
                                <input
                                    type="password"
                                    id="loginPassword"
                                    className="formInput"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>

                            <button type="submit" className="button">
                                <span className="buttonText">Login</span>
                            </button>
                        </form>

                        <p className="smallText" style={{ marginTop: '20px' }}>
                            Don't have an account?{' '}
                            <a href="#" className="termsLink" onClick={(e) => { e.preventDefault(); setActiveScreen('CreatorSignUp'); }}>Sign Up Here</a>
                        </p>

                        <button
                            className="button"
                            onClick={() => setActiveScreen('Home')}
                            style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                        >
                            <span className="buttonText">Back to Home</span>
                        </button>
                    </div>
                );
            };

            const CreatorDashboardScreen = ({ showMessage, setActiveScreen, currentUser, creatorProfile, setCreatorProfile, creatorCampaigns, setShowConfirmationModal, setConfirmationTitle, setConfirmationMessage, setOnConfirmationAction }) => {
                const [isEditingProfile, setIsEditingProfile] = useState(false);
                const [editCreatorName, setEditCreatorName] = useState('');
                const [editBio, setEditBio] = useState('');
                const [editCategories, setEditCategories] = useState([]);
                const [editExistingWorkLink, setEditExistingWorkLink] = useState('');

                const profilePictureInputRef = useRef(null);
                const [uploadedVideos, setUploadedVideos] = useState({
                    youtube: null,
                    facebook: null,
                    tiktok: null
                });
                const [youtubeInputLink, setYoutubeInputLink] = useState('');
                const [facebookInputLink, setFacebookInputLink] = useState('');
                const [tiktokInputLink, setTiktokInputLink] = useState(''); // Corrected state variable name

                const [showImageAdjustModal, setShowImageAdjustModal] = useState(false);
                const [imageFileToAdjust, setImageFileToAdjust] = useState(null);

                useEffect(() => {
                    if (creatorProfile) {
                        setEditCreatorName(creatorProfile.creatorName || '');
                        setEditBio(creatorProfile.bio || '');
                        setEditCategories(creatorProfile.categories || []);
                        setEditExistingWorkLink(creatorProfile.existingWorkLink || '');
                        setUploadedVideos(creatorProfile.uploadedVideos || { youtube: null, facebook: null, tiktok: null });
                    }
                }, [creatorProfile]);


                const handleSaveProfile = async () => {
                    try {
                        const creatorRef = doc(db, "creators", currentUser.uid);
                        await updateDoc(creatorRef, {
                            creatorName: editCreatorName,
                            bio: editBio,
                            categories: editCategories,
                            existingWorkLink: editExistingWorkLink,
                            updatedAt: new Date().toISOString()
                        });
                        setCreatorProfile(prev => ({
                            ...prev,
                            creatorName: editCreatorName,
                            bio: editBio,
                            categories: editCategories,
                            existingWorkLink: editExistingWorkLink,
                        }));
                        setIsEditingProfile(false);
                        showMessage("Profile updated successfully!");
                    } catch (error) {
                        console.error("Error saving profile:", error);
                        showMessage("Failed to save profile. Please try again.");
                    }
                };

                const handleCancelEdit = () => {
                    setEditCreatorName(creatorProfile.creatorName || '');
                    setEditBio(creatorProfile.bio || '');
                    setEditCategories(creatorProfile.categories || []);
                    setEditExistingWorkLink(creatorProfile.existingWorkLink || '');
                    setIsEditingProfile(false);
                    showMessage("Profile editing cancelled.");
                };

                const handleProfileCategoryChange = (e) => {
                    const { value, checked } = e.target;
                    if (checked) {
                        setEditCategories((prev) => [...prev, value]);
                    } else {
                        setEditCategories((prev) => prev.filter((cat) => cat !== value));
                    }
                };

                const triggerProfilePictureUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        setImageFileToAdjust(file);
                        setShowImageAdjustModal(true);
                    }
                };

                const handleSaveAdjustedProfilePicture = async (adjustedBlob) => {
                    if (!currentUser || !adjustedBlob) {
                        showMessage("Error: No user or image to save.");
                        return;
                    }

                    setShowImageAdjustModal(false);
                    showMessage('Uploading profile picture...');

                    try {
                        const fileName = `profile_${currentUser.uid}_${Date.now()}.png`;
                        const storageRefPath = ref(storage, `profile_pictures/${currentUser.uid}/${fileName}`);

                        await uploadBytes(storageRefPath, adjustedBlob, { contentType: 'image/png' });
                        const downloadURL = await getDownloadURL(storageRefPath);

                        const creatorRef = doc(db, "creators", currentUser.uid);
                        await updateDoc(creatorRef, {
                            profilePictureUrl: downloadURL,
                            updatedAt: new Date().toISOString()
                        });
                        setCreatorProfile(prev => ({ ...prev, profilePictureUrl: downloadURL }));
                        showMessage("Profile picture uploaded successfully!");
                    } catch (error) {
                        console.error("Error uploading adjusted profile picture:", error);
                        showMessage("Failed to upload profile picture. Please try again.");
                    }
                };

                const handleCancelAdjust = () => {
                    setShowImageAdjustModal(false);
                    setImageFileToAdjust(null);
                    showMessage("Profile picture adjustment cancelled.");
                };

                const extractYouTubeId = (url) => {
                    const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|shorts\/))([^&?#]+)/);
                    return match ? match[1] : null;
                };

                const extractFacebookId = (url) => {
                    let videoId = null;
                    let match = url.match(/(?:facebook\.com\/(?:video.php\?v=|watch\/\?v=)|fb\.watch\/|facebook\.com\/[^\/]+\/videos\/)([0-9]+)/);
                    if (match && match[1]) {
                        videoId = match[1];
                    } else {
                        match = url.match(/facebook\.com\/[a-zA-Z0-9\._-]+\/videos\/(\d+)/);
                        if(match && match[1]) {
                            videoId = match[1];
                        }
                    }
                    return videoId;
                };

                const extractTikTokId = (url) => {
                    const match = url.match(/(?:tiktok\.com\/@(?:[a-zA-Z0-9._]+)\/video\/|vm\.tiktok\.com\/|tiktok\.com\/embed\/)([0-9]+)/);
                    return match ? match[1] : null;
                };

                const getThumbnailAndEmbed = (platform, url) => {
                    let videoId = null;
                    let thumbnailUrl = '';
                    let embedUrl = '';
                    let title = '';

                    switch (platform) {
                        case 'youtube':
                            videoId = extractYouTubeId(url);
                            if (videoId) {
                                thumbnailUrl = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
                                title = 'YouTube Video';
                            }
                            break;
                        case 'facebook':
                            videoId = extractFacebookId(url);
                            if (videoId) {
                                thumbnailUrl = `https://placehold.co/150x100/4267B2/FFFFFF?text=Facebook+Video`;
                                embedUrl = `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=0&width=560&autoplay=1`;
                                title = 'Facebook Video (May require public setting or open in new tab)';
                            } else {
                                thumbnailUrl = `https://placehold.co/150x100/999999/FFFFFF?text=Invalid+FB+Video`;
                                embedUrl = '';
                                title = 'Invalid Facebook Video Link';
                            }
                            break;
                        case 'tiktok':
                            videoId = extractTikTokId(url);
                            if (videoId) {
                                thumbnailUrl = `https://placehold.co/150x100/69C9D0/FFFFFF?text=TikTok+Video`;
                                embedUrl = `https://www.tiktok.com/embed/${videoId}`;
                                title = 'TikTok Video';
                            } else {
                                thumbnailUrl = `https://placehold.co/150x100/999999/FFFFFF?text=Invalid+TikTok+Video`;
                                embedUrl = '';
                                title = 'Invalid TikTok Video Link';
                            }
                            break;
                        default:
                            break;
                    }
                    return { videoId, thumbnailUrl, embedUrl, title };
                };

                const handleAddOrUpdateVideo = async (platform, inputUrl) => {
                    if (!inputUrl) {
                        showMessage(`Please enter a URL for the ${platform} video.`);
                        return;
                    }
                    const { videoId, thumbnailUrl, embedUrl, title } = getThumbnailAndEmbed(platform, inputUrl);

                    if (videoId && embedUrl) {
                        const updated = { url: inputUrl, thumbnailUrl, embedUrl, title };
                        setUploadedVideos(prev => ({
                            ...prev,
                            [platform]: updated
                        }));
                        try {
                            const creatorRef = doc(db, "creators", currentUser.uid);
                            await updateDoc(creatorRef, {
                                [`uploadedVideos.${platform}`]: updated,
                                updatedAt: new Date().toISOString()
                            });
                            showMessage(`${platform} video added successfully!`);
                            if (platform === 'youtube') setYoutubeInputLink('');
                            else if (platform === 'facebook') setFacebookInputLink('');
                            else if (platform === 'tiktok') setTiktokInputLink('');
                        } catch (error) {
                            console.error(`Error saving ${platform} video to Firestore:`, error);
                            showMessage(`Failed to save ${platform} video. Please check your internet connection and Firestore rules.`);
                        }

                    } else {
                        showMessage(`Invalid ${platform} video URL provided. Please check the link.`);
                    }
                };

                const handleRemoveVideo = async (platform) => {
                    setUploadedVideos(prev => ({
                        ...prev,
                        [platform]: null
                    }));
                    try {
                        const creatorRef = doc(db, "creators", currentUser.uid);
                        await updateDoc(creatorRef, {
                            [`uploadedVideos.${platform}`]: null,
                            updatedAt: new Date().toISOString()
                        });
                        showMessage(`${platform} video removed successfully.`);
                    } catch (error) {
                        console.error(`Error removing ${platform} video from Firestore:`, error);
                        showMessage(`Failed to remove ${platform} video. Please check your internet connection and Firestore rules.`);
                    }
                };

                // Handle creator cancelling their campaign
                const confirmCancelCampaign = (campaignId, campaignTitle) => {
                    setShowConfirmationModal(true);
                    setConfirmationTitle("Cancel Campaign?");
                    setConfirmationMessage(`Are you sure you want to cancel your campaign "${campaignTitle}"? This action cannot be undone.`);
                    setOnConfirmationAction(() => () => handleCancelCampaign(campaignId, campaignTitle)); // Wrap in another arrow function to pass args
                };

                const handleCancelCampaign = async (campaignId, campaignTitle) => {
                    setShowConfirmationModal(false); // Close modal
                    try {
                        const campaignDocRef = doc(db, `artifacts/${appId}/public/data/campaigns`, campaignId);
                        await updateDoc(campaignDocRef, {
                            status: 'cancelled', // Set status to 'cancelled'
                            cancelledBy: currentUser.uid,
                            cancelledAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                        showMessage(`Campaign "${campaignTitle}" has been cancelled.`);
                        // onSnapshot will automatically update the list
                    } catch (error) {
                        console.error("Error cancelling campaign:", error);
                        showMessage(`Failed to cancel campaign: ${error.message}`);
                    }
                };

                if (!currentUser) {
                    return (
                        <div className="screenContainer">
                            <p className="heading">Access Denied</p>
                            <p className="subHeading">Please login to access the Creator Dashboard.</p>
                            <button
                                className="button"
                                onClick={() => setActiveScreen('Login')}
                            >
                                <span className="buttonText">Go to Login</span>
                            </button>
                             <button
                                className="button"
                                onClick={() => setActiveScreen('Home')}
                                style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '10px' }}
                            >
                                <span className="buttonText">Back to Home</span>
                            </button>
                        </div>
                    );
                }

                if (!creatorProfile) {
                    return (
                        <div className="screenContainer" style={{ textAlign: 'center', paddingTop: '50px' }}>
                            <p className="heading">Loading Creator Profile...</p>
                            <p className="subHeading" style={{ color: '#FFD700' }}>Please ensure you are logged in and have an internet connection.</p>
                            <p className="smallText" style={{ color: '#888' }}>
                                If this takes too long, check your Firebase Firestore rules or refresh the app.
                            </p>
                        </div>
                    );
                }

                // Filter campaigns into active, pending, ended, cancelled, rejected
                const now = new Date();
                const activeCampaigns = creatorCampaigns.filter(c => c.status === 'active' && new Date(c.endDate) > now);
                const pendingCampaigns = creatorCampaigns.filter(c => c.status === 'pending');
                const endedCampaigns = creatorCampaigns.filter(c => new Date(c.endDate) <= now);
                const rejectedCampaigns = creatorCampaigns.filter(c => c.status === 'rejected');
                const cancelledCampaigns = creatorCampaigns.filter(c => c.status === 'cancelled'); // New filter for cancelled


                const hasActiveCampaign = activeCampaigns.length > 0;
                const creatorActiveCampaign = hasActiveCampaign ? activeCampaigns[0] : null; // Assuming one active campaign
                const activeCampaignDaysRemaining = creatorActiveCampaign ? Math.ceil((new Date(creatorActiveCampaign.endDate).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24)) : 0;


                return (
                    <>
                        <div className="screenContainer">
                            <p className="heading">Creator Dashboard</p>
                            <p className="subHeading">Welcome, {creatorProfile.creatorName || currentUser.email}!</p>

                            <div className="dashboardSection">
                                <p className="dashboardSectionTitle">Your Profile</p>
                                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '15px' }}>
                                    <img
                                        src={creatorProfile.profilePictureUrl || 'https://placehold.co/100x100/555/FFF?text=Profile'}
                                        alt="Profile"
                                        style={{ width: '100px', height: '100px', borderRadius: '50%', objectFit: 'cover', marginRight: '15px' }}
                                        onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/100x100/555/FFF?text=Profile'; }}
                                    />
                                    <input
                                        type="file"
                                        ref={profilePictureInputRef}
                                        style={{ display: 'none' }}
                                        onChange={triggerProfilePictureUpload}
                                        accept="image/*"
                                    />
                                    <button
                                        className="dashboardButton"
                                        onClick={() => profilePictureInputRef.current.click()}
                                    >
                                        Upload Profile Picture
                                    </button>
                                </div>


                                {isEditingProfile ? (
                                    <>
                                        <div className="formGroup">
                                            <label htmlFor="editCreatorName" className="formLabel">Creator Name (Public):</label>
                                            <input
                                                type="text"
                                                id="editCreatorName"
                                                className="formInput"
                                                value={editCreatorName}
                                                onChange={(e) => setEditCreatorName(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <div className="formGroup">
                                            <label htmlFor="editBio" className="formLabel">Brief Bio/Description:</label>
                                            <textarea
                                                id="editBio"
                                                className="formTextarea"
                                                value={editBio}
                                                onChange={(e) => setBio(e.target.value)}
                                                required
                                            ></textarea>
                                        </div>
                                        <div className="checkboxGroup">
                                            <p className="checkboxLabel">Content Categories:</p>
                                            {['Skits', 'Short Films', 'Interviews', 'Live Premieres', 'Music', 'Documentary', 'Other'].map((cat) => (
                                                <div key={cat} className="checkboxItem">
                                                    <input
                                                        type="checkbox"
                                                        id={`edit-cat-${cat}`}
                                                        value={cat}
                                                        checked={editCategories.includes(cat)}
                                                        onChange={handleProfileCategoryChange}
                                                    />
                                                    <label htmlFor={`edit-cat-${cat}`}>{cat}</label>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="formGroup">
                                            <label htmlFor="editExistingWork" className="formLabel">Link to Existing Work:</label>
                                            <input
                                                type="url"
                                                id="editExistingWork"
                                                className="formInput"
                                                value={editExistingWorkLink}
                                                onChange={(e) => setEditExistingWorkLink(e.target.value)}
                                                placeholder="e.g., YouTube channel, Instagram profile"
                                            />
                                        </div>
                                        <button className="dashboardButton" onClick={handleSaveProfile}>Save Changes</button>
                                        <button className="dashboardButton" onClick={handleCancelEdit} style={{ backgroundColor: '#555' }}>Cancel</button>
                                    </>
                                ) : (
                                    <>
                                        <p className="dashboardItem">{creatorProfile.creatorName}</p>
                                        <p className="dashboardItem">{creatorProfile.email}</p>
                                        <p className="dashboardItem">{creatorProfile.bio || 'No bio provided.'}</p>
                                        <p className="dashboardItem">{(creatorProfile.categories && creatorProfile.categories.length > 0) ? creatorProfile.categories.join(', ') : 'No categories selected.'}</p>
                                        {creatorProfile.existingWorkLink && <p className="dashboardItem"><a href={creatorProfile.existingWorkLink} target="_blank" style={{ color: '#FFD700', textDecoration: 'none' }}>{creatorProfile.existingWorkLink}</a></p>}
                                        <button
                                            className="dashboardButton"
                                            onClick={() => setIsEditingProfile(true)}
                                        >
                                            Edit Profile
                                        </button>
                                    </>
                                )}
                            </div>

                            <div className="dashboardSection">
                                <p className="dashboardSectionTitle">My Crowdfunding Campaigns</p>
                                {hasActiveCampaign && creatorActiveCampaign ? (
                                    <>
                                        <p className="dashboardItem" style={{ color: '#00FF00', fontWeight: 'bold' }}>Active Campaign:</p>
                                        <div className="allCampaignsListItem" style={{marginBottom: '10px'}}
                                            onClick={() => {
                                                setSelectedCampaignId(creatorActiveCampaign.id);
                                                setActiveScreen('CampaignDetails');
                                            }}
                                        >
                                            <div
                                                className="campaignListImagePlaceholder"
                                                style={{ backgroundImage: creatorActiveCampaign.imageUrl ? `url(${creatorActiveCampaign.imageUrl})` : 'none' }}
                                                onError={(e) => { e.target.onerror = null; e.target.style.backgroundImage='none'; }}
                                            >
                                                <button
                                                    className="campaignListProjectButton"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        if (creatorActiveCampaign.imageUrl) {
                                                            window.open(creatorActiveCampaign.imageUrl, '_blank');
                                                        } else {
                                                            showMessage('No project link provided for this campaign.');
                                                        }
                                                    }}
                                                >
                                                    View Project
                                                </button>
                                            </div>
                                            <div className="campaignListContent">
                                                <p className="campaignListTitle">
                                                    {creatorActiveCampaign.title}
                                                </p>
                                                <p className="campaignListDescription" style={{ WebkitLineClamp: '1' }}>{creatorActiveCampaign.description}</p>
                                                <div className="campaignProgressContainer" style={{ height: '5px', marginBottom: '5px' }}>
                                                    <div
                                                        className="campaignProgressBar"
                                                        style={{ width: `${(creatorActiveCampaign.raised / creatorActiveCampaign.goal) * 100}%` }}
                                                    ></div>
                                                </div>
                                                <div className="campaignListStats">
                                                    <span>Raised: <span className="campaignListRaised">${creatorActiveCampaign.raised}</span></span>
                                                    <span>Goal: <span className="campaignListGoal">${creatorActiveCampaign.goal}</span></span>
                                                </div>
                                                <p className="smallText" style={{ textAlign: 'left', color: '#FFD700', marginTop: '5px' }}>
                                                    {activeCampaignDaysRemaining > 0 ? `${activeCampaignDaysRemaining} days remaining` : 'Campaign ending soon!'}
                                                </p>
                                            </div>
                                        </div>
                                        <p className="dashboardItem">
                                            You currently have one active campaign. To create another, please wait for this campaign to end.
                                        </p>
                                        <button
                                            className="dashboardButton"
                                            onClick={() => {
                                                setSelectedCampaignId(creatorActiveCampaign.id);
                                                setActiveScreen('CampaignDetails');
                                            }}
                                            style={{ backgroundColor: '#555', cursor: 'pointer' }}
                                        >
                                            View Active Campaign
                                        </button>
                                        {/* New Cancel Button for Creators */}
                                        <button
                                            className="dashboardButton"
                                            onClick={() => confirmCancelCampaign(creatorActiveCampaign.id, creatorActiveCampaign.title)}
                                            style={{ backgroundColor: '#DC3545', color: '#FFF', marginTop: '10px' }}
                                        >
                                            <span className="buttonText">Cancel My Campaign</span>
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <p className="dashboardItem">
                                            You don't have any active campaigns. You can create one below!
                                        </p>
                                        <button
                                            className="dashboardButton"
                                            onClick={() => setActiveScreen('CreateCampaign')}
                                        >
                                            Create New Campaign
                                        </button>
                                    </>
                                )}

                                {pendingCampaigns.length > 0 && (
                                    <>
                                        <p className="dashboardItem" style={{ color: '#FFD700', fontWeight: 'bold', marginTop: '20px' }}>Pending Campaigns:</p>
                                        <div className="dashboardContentList">
                                            {pendingCampaigns.map(campaign => (
                                                <div key={campaign.id} className="dashboardContentListItem"
                                                    onClick={() => {
                                                        setSelectedCampaignId(campaign.id);
                                                        setActiveScreen('CampaignDetails');
                                                    }}>
                                                    <span>{campaign.title}</span>
                                                    <span style={{color: '#FFD700', fontSize: '12px', marginLeft: '10px'}}>(Pending)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}

                                {rejectedCampaigns.length > 0 && (
                                    <>
                                        <p className="dashboardItem" style={{ color: '#DC3545', fontWeight: 'bold', marginTop: '20px' }}>Rejected Campaigns:</p>
                                        <div className="dashboardContentList">
                                            {rejectedCampaigns.map(campaign => (
                                                <div key={campaign.id} className="dashboardContentListItem"
                                                    onClick={() => {
                                                        setSelectedCampaignId(campaign.id);
                                                        setActiveScreen('CampaignDetails');
                                                    }}>
                                                    <span>{campaign.title}</span>
                                                    <span style={{color: '#DC3545', fontSize: '12px', marginLeft: '10px'}}>(Rejected)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}

                                {cancelledCampaigns.length > 0 && (
                                    <>
                                        <p className="dashboardItem" style={{ color: '#888', fontWeight: 'bold', marginTop: '20px' }}>Cancelled Campaigns:</p>
                                        <div className="dashboardContentList">
                                            {cancelledCampaigns.map(campaign => (
                                                <div key={campaign.id} className="dashboardContentListItem"
                                                    onClick={() => {
                                                        setSelectedCampaignId(campaign.id);
                                                        setActiveScreen('CampaignDetails');
                                                    }}>
                                                    <span>{campaign.title}</span>
                                                    <span style={{color: '#888', fontSize: '12px', marginLeft: '10px'}}>(Cancelled)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}

                                {endedCampaigns.length > 0 && (
                                    <>
                                        <p className="dashboardItem" style={{ color: '#CCC', fontWeight: 'bold', marginTop: '20px' }}>Ended Campaigns:</p>
                                        <div className="dashboardContentList">
                                            {endedCampaigns.map(campaign => (
                                                <div key={campaign.id} className="dashboardContentListItem"
                                                    onClick={() => {
                                                        setSelectedCampaignId(campaign.id);
                                                        setActiveScreen('CampaignDetails');
                                                    }}>
                                                    <span>{campaign.title}</span>
                                                    <span style={{color: '#DC3545', fontSize: '12px', marginLeft: '10px'}}>(Ended)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}
                            </div>


                            <div className="dashboardSection">
                                <p className="dashboardSectionTitle">My Uploaded Videos</p>
                                <div className="videoLinkSection">
                                    <label htmlFor="youtubeLink" className="formLabel">YouTube Video Link:</label>
                                    <div className="videoInputContainer">
                                        <input
                                            type="url"
                                            id="youtubeLink"
                                            className="formInput"
                                            value={youtubeInputLink}
                                            onChange={(e) => setYoutubeInputLink(e.target.value)}
                                            placeholder="e.g., https://www.youtube.com/watch?v=VIDEO_ID"
                                        />
                                        {uploadedVideos.youtube ? (
                                            <button className="actionButton remove" onClick={() => handleRemoveVideo('youtube')}>Remove</button>
                                        ) : (
                                            <button className="actionButton" onClick={() => handleAddOrUpdateVideo('youtube', youtubeInputLink)}>Add</button>
                                        )}
                                    </div>
                                    {uploadedVideos.youtube && (
                                        <div className="videoThumbnailContainer" onClick={() => handleVideoPress(uploadedVideos.youtube.embedUrl)}>
                                            <img src={uploadedVideos.youtube.thumbnailUrl} alt="YouTube Thumbnail" className="videoThumbnail" />
                                            <div className="videoThumbnailOverlay">
                                                <svg className="thumbnailPlayIcon" viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z"/>
                                                </svg>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="videoLinkSection">
                                    <label htmlFor="facebookLink" className="formLabel">Facebook Video Link:</label>
                                    <div className="videoInputContainer">
                                        <input
                                            type="url"
                                            id="facebookLink"
                                            className="formInput"
                                            value={facebookInputLink}
                                            onChange={(e) => setFacebookInputLink(e.target.value)}
                                            placeholder="e.g., https://www.facebook.com/video.php?v=VIDEO_ID or https://fb.watch/..."
                                        />
                                        {uploadedVideos.facebook ? (
                                            <button className="actionButton remove" onClick={() => handleRemoveVideo('facebook')}>Remove</button>
                                        ) : (
                                            <button className="actionButton" onClick={() => handleAddOrUpdateVideo('facebook', facebookInputLink)}>Add</button>
                                        )}
                                    </div>
                                    {uploadedVideos.facebook && (
                                        <div className="videoThumbnailContainer" onClick={() => handleVideoPress(uploadedVideos.facebook.embedUrl)}>
                                            <img src={uploadedVideos.facebook.thumbnailUrl} alt="Facebook Thumbnail" className="videoThumbnail" />
                                            <div className="videoThumbnailOverlay">
                                                <svg className="thumbnailPlayIcon" viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z"/>
                                                </svg>
                                            </div>
                                        </div>
                                    )}
                                    <p className="smallText" style={{ textAlign: 'left', color: '#FFD700', marginTop: '5px' }}>
                                        Note: Facebook video embedding can be temperamental due to privacy settings. Not all links may play in-app.
                                    </p>
                                </div>

                                <div className="videoLinkSection">
                                    <label htmlFor="tiktokLink" className="formLabel">TikTok Video Link:</label>
                                    <div className="videoInputContainer">
                                        <input
                                            type="url"
                                            id="tiktokLink"
                                            className="formInput"
                                            value={tiktokInputLink}
                                            onChange={(e) => setTiktokInputLink(e.target.value)}
                                            placeholder="e.g., https://www.tiktok.com/@user/video/VIDEO_ID"
                                        />
                                        {uploadedVideos.tiktok ? (
                                            <button className="actionButton remove" onClick={() => handleRemoveVideo('tiktok')}>Remove</button>
                                        ) : (
                                            <button className="actionButton" onClick={() => handleAddOrUpdateVideo('tiktok', tiktokInputLink)}>Add</button>
                                        )}
                                    </div>
                                    {uploadedVideos.tiktok && (
                                        <div className="videoThumbnailContainer" onClick={() => handleVideoPress(uploadedVideos.tiktok.embedUrl)}>
                                            <img src={uploadedVideos.tiktok.thumbnailUrl} alt="TikTok Thumbnail" className="videoThumbnail" />
                                            <div className="videoThumbnailOverlay">
                                                <svg className="thumbnailPlayIcon" viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z"/>
                                                </svg>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="dashboardSection">
                                <p className="dashboardSectionTitle">Analytics Overview</p>
                                <p className="dashboardItem">Total Views: 15,450 (Last 30 days)</p>
                                <p className="dashboardItem">Total Crowdfunding Raised: $3,450</p>
                                <p className="dashboardItem">Audience Engagement: High</p>
                                <button
                                    className="dashboardButton"
                                    onClick={() => showMessage('Detailed analytics report functionality coming soon!')}
                                >
                                    View Full Analytics
                                </button>
                            </div>

                            <button
                                className="button"
                                onClick={() => setActiveScreen('Home')}
                                style={{ backgroundColor: '#3A3A3A', color: '#FFF', marginTop: '30px' }}
                            >
                                <span className="buttonText">Back to Home</span>
                            </button>
                        </div>
                        {showImageAdjustModal && imageFileToAdjust && (
                            <ProfilePictureAdjustModal
                                imageUrl={URL.createObjectURL(imageFileToAdjust)}
                                onSave={handleSaveAdjustedProfilePicture}
                                onCancel={handleCancelAdjust}
                                showMessage={showMessage}
                            />
                        )}
                    </>
                );
            };


            const renderScreen = () => {
                // If an admin has selected a campaign to review, show AdminCampaignDetailsScreen
                if (activeScreen === 'AdminCampaignDetails') { // Removed selectedAdminCampaignId check here so it can be passed through to the component regardless for display
                    return <AdminCampaignDetailsScreen showMessage={showMessage} setActiveScreen={setActiveScreen} currentUser={currentUser} selectedAdminCampaignId={selectedAdminCampaignId} setShowConfirmationModal={setShowConfirmationModal} setConfirmationTitle={setConfirmationTitle} setConfirmationMessage={setConfirmationMessage} setOnConfirmationAction={setOnConfirmationAction} creatorProfile={creatorProfile} />;
                }
                // Otherwise, render screens based on activeScreen state
                switch (activeScreen) {
                    case 'Home':
                        return <HomeScreen />;
                    case 'Discover': // Updated case name for consistency
                        return <CategoriesScreen />;
                    case 'Login':
                        return <LoginScreen showMessage={showMessage} setActiveScreen={setActiveScreen} />;
                    case 'CreatorSignUp':
                        return <CreatorSignUpScreen showMessage={showMessage} setActiveScreen={setActiveScreen} />;
                    case 'Premium':
                        return <PremiumScreen />;
                    case 'Support': // Corresponds to CrowdfundingScreen
                        return <CrowdfundingScreen showMessage={showMessage} setActiveScreen={setActiveScreen} />;
                    case 'AllCampaigns': // This screen is now only accessible via "Browse Creator Campaigns" button
                        return <AllCampaignsScreen showMessage={showMessage} setActiveScreen={setActiveScreen} setSelectedCampaignId={setSelectedCampaignId} />;
                    case 'CampaignDetails':
                        return <CampaignDetailsScreen showMessage={showMessage} setActiveScreen={setActiveScreen} selectedCampaignId={selectedCampaignId} currentUser={currentUser} />;
                    case 'CreatorDashboard':
                        return <CreatorDashboardScreen showVideoModal={showVideoModal} setShowVideoModal={setShowVideoModal} currentVideoUrl={currentVideoUrl} setCurrentVideoUrl={setCurrentVideoUrl} showMessage={showMessage} setActiveScreen={setActiveScreen} currentUser={currentUser} creatorProfile={creatorProfile} setCreatorProfile={setCreatorProfile} creatorCampaigns={creatorCampaigns} setShowConfirmationModal={setShowConfirmationModal} setConfirmationTitle={setConfirmationTitle} setConfirmationMessage={setConfirmationMessage} setOnConfirmationAction={setOnConfirmationAction} />;
                    case 'AdminDashboard':
                        // Pass setSelectedAdminCampaignId to AdminDashboardScreen
                        return <AdminDashboardScreen showMessage={showMessage} setActiveScreen={setActiveScreen} currentUser={currentUser} setSelectedAdminCampaignId={setSelectedAdminCampaignId} creatorProfile={creatorProfile} />;
                    case 'About':
                        return <AboutContactScreen />;
                    default:
                        return <HomeScreen />;
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <img
                            src="https://nva-network-app.netlify.app/NVA%20Network%20LOGO%20FX.png"
                            alt="NVA Network Logo"
                            className="headerLogo"
                            onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/450x150/1A1A1A/FFD700?text=Logo+Error'; }}
                        />
                        <p className="headerTitle">NVA Network</p>
                        <p className="tagline">Guyanese Content to a Global Stage.</p>
                    </div>

                    {renderScreen()}

                    <div className="navigationBar">
                        <button className="navButton" onClick={() => setActiveScreen('Home')}>
                            <span className={`navButtonText ${activeScreen === 'Home' ? 'activeNavButtonText' : ''}`}>Home</span>
                        </button>
                        {/* Removed Discover button from here, it's now on Home screen */}
                        {/* Removed "Support Us" button from here as it's now on the top right of the Home screen */}
                        {/* Removed "Campaigns" button from here */}
                        <button className="navButton" onClick={() => setActiveScreen('Premium')}>
                            <span className={`navButtonText ${activeScreen === 'Premium' ? 'activeNavButtonText' : ''}`}>Premium</span>
                        </button>
                        {/* Dashboard Button - Only visible if logged in */}
                        {currentUser && (
                            <button className="navButton" onClick={() => setActiveScreen('CreatorDashboard')}>
                                <span className={`navButtonText ${activeScreen === 'CreatorDashboard' ? 'activeNavButtonText' : ''}`}>Dashboard</span>
                            </button>
                        )}
                        {/* Admin Dashboard Button - Only visible to admins or authority */}
                        {currentUser && creatorProfile && (creatorProfile.role === 'admin' || creatorProfile.role === 'authority') && (
                            <button className="navButton" onClick={() => setActiveScreen('AdminDashboard')}>
                                <span className={`navButtonText ${activeScreen === 'AdminDashboard' ? 'activeNavButtonText' : ''}`}>Admin</span>
                            </button>
                        )}
                        <button className="navButton" onClick={() => setActiveScreen('About')}>
                            <span className={`navButtonText ${activeScreen === 'About' ? 'activeNavButtonText' : ''}`}>About</span>
                        </button>
                    </div>

                    {message && (
                        <div className="messageBox">
                            <p className="messageText">{message}</p>
                        </div>
                    )}

                    {showVideoModal && (
                        <VideoPlayerModal videoUrl={currentVideoUrl} onClose={closeVideoModal} />
                    )}

                    {showConfirmationModal && (
                        <ConfirmationModal
                            title={confirmationTitle}
                            message={confirmationMessage}
                            onConfirm={onConfirmationAction}
                            onCancel={() => setShowConfirmationModal(false)}
                        />
                    )}
                </div>
            );
        }

        window.onload = function() {
            if (
                typeof window.firebaseAuth === 'undefined' ||
                typeof window.onAuthStateChanged === 'undefined' ||
                typeof window.firebaseDb === 'undefined' ||
                typeof window.firebaseStorage === 'undefined' ||
                typeof ReactDOM === 'undefined'
            ) {
                console.error("Firebase or ReactDOM not fully initialized. Retrying render...");
                setTimeout(window.onload, 100);
                return;
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        };
    </script>
</body>
</html>
